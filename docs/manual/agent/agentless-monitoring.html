<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agentless Monitoring &#8212; OpenArmor</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-3.2.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-3.2.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/parallax.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script src="../../../_static/js/jquery-fix.js"></script>
    <script src="../../../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Writing Agentless Scripts" href="agentless-scripts.html" />
    <link rel="prev" title="Centralized agent configuration" href="agent-configuration.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138780766-1"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-138780766-1');
</script>

<script type="text/javascript">
  var _ss = _ss || [];
  _ss.push(['_setDomain', 'https://koi-3QNN51VTHS.marketingautomation.services/net']);
  _ss.push(['_setAccount', 'KOI-4APYNOYP8O']);
  _ss.push(['_trackPageView']);
  window._pa = window._pa || {};
  // _pa.orderId = "myOrderId"; // OPTIONAL: attach unique conversion identifier to conversions
  // _pa.revenue = "19.99"; // OPTIONAL: attach dynamic purchase values to conversions
  // _pa.productId = "myProductId"; // OPTIONAL: Include product ID for use with dynamic ads
  (function() {
  var ss = document.createElement('script');
  ss.type = 'text/javascript'; ss.async = true;
  ss.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'koi-3QNN51VTHS.marketingautomation.services/client/ss.js?ver=2.4.0';
  var scr = document.getElementsByTagName('script')[0];
  scr.parentNode.insertBefore(ss, scr);
  })();
  </script>



  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html"><img src="../../../_static/OpenArmor_logo_bare_small.jpg">
          OpenArmor</a>
        <span class="navbar-text navbar-version pull-left"><b>3.6.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://theopenarmor.org/about/">About</a></li>
                <li><a href="https://theopenarmor.org/docs/">Documentation</a></li>
                <li><a href="https://theopenarmor.org/register-for-OpenArmor/">Get OpenArmor+</a></li>
                <li><a href="https://theopenarmor.org/downloads/">Downloads</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cookbooks/index.html">User submitted Cookbooks</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/build/index.html">Build, compile, and not much more</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/oRFC/index.html">oRFC:</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../syntax/index.html">Syntax and Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../formats/index.html">Output Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../programs/index.html">Man pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="agent-configuration.html" title="Previous Chapter: Centralized agent configuration"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Centralized a...</span>
    </a>
  </li>
  <li>
    <a href="agentless-scripts.html" title="Next Chapter: Writing Agentless Scripts"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Writing Agent... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="agentless-monitoring">
<span id="manual-agentless"></span><h1>Agentless Monitoring<a class="headerlink" href="#agentless-monitoring" title="Permalink to this headline">¶</a></h1>
<p><strong>Agentless monitoring</strong> allows you to run integrity checking
on systems without an agent installed (including routers, firewalls,
switches and even Linux/BSD systems). It can be executed just like our normal file
integrity checking (alerting of checksum changes) or doing diffs and showing
exactly what has changed.</p>
<div class="section" id="agentless-configuration-options">
<h2>Agentless configuration options<a class="headerlink" href="#agentless-configuration-options" title="Permalink to this headline">¶</a></h2>
<p>Check <cite>manual-agentless-scripts</cite> for more information.</p>
</div>
<div class="section" id="getting-started-with-agentless">
<h2>Getting started with agentless<a class="headerlink" href="#getting-started-with-agentless" title="Permalink to this headline">¶</a></h2>
<p>After you installed OpenArmor, you need to enable the agentless monitoring:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>/var/OpenArmor/bin/OpenArmor-control <span class="nb">enable</span> agentless
</pre></div>
</div>
<p>And provide the SSH authentication to the host you want to access. For Cisco devices
(PIX, routers, etc), you need to provide an additional parameter for the enable password.
The same thing applies if you want to add support for “su”, it must be the additional
parameter. In this example, I am adding a Linux box (example.net) and a PIX firewall
(pix.fw.local):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>/var/OpenArmor/agentless/register_host.sh add root@example.net mypass1
<span class="go">  *Host root@example.netl added.</span>
<span class="gp"># </span>/var/OpenArmor/agentless/register_host.sh add pix@pix.fw.local pixpass enablepass
<span class="go">  *Host pix@pix.fw.local added.</span>

<span class="gp"># </span>/var/OpenArmor/agentless/register_host.sh list
<span class="go">  *Available hosts:</span>
<span class="go">pix@pix.fw.local</span>
<span class="go">root@example.net</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">register_host.sh</span></code> is a shell script, special characters may need to be escaped to not be interpreted by the shell.</p>
</div>
<p>If you want to use public key authentication instead of
passwords, you need to provide NOPASS as the password and
create the public key:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>sudo -u OpenArmor ssh-keygen
</pre></div>
</div>
<p>It will create the public keys inside /var/OpenArmor/.ssh .  After that, just scp the
public key to the remote box and your password less connection should work.</p>
</div>
<div class="section" id="configuring-agentless">
<h2>Configuring agentless<a class="headerlink" href="#configuring-agentless" title="Permalink to this headline">¶</a></h2>
<p>Once you have added all your systems, you need to configure
OpenArmor to monitor them. By default, we have 4 agentless types
(but we plan to add more soon):</p>
<ul class="simple">
<li><p>ssh_integrity_check_bsd</p></li>
<li><p>ssh_integrity_check_linux</p></li>
<li><p>ssh_generic_diff</p></li>
<li><p>ssh_pixconfig_diff</p></li>
</ul>
<p>For the first two, you give a list of directories in the configuration and OpenArmor
will do the integrity checking of them on the remote box. On the
ssh_generic_diff, you give a set of commands to run on the remote box and OpenArmor
will alert when the output of them changes. The ssh_pixconfig_diff will alert
when a Cisco PIX/router configuration changes.</p>
<p>So, for my first system (<a class="reference external" href="mailto:root&#37;&#52;&#48;example&#46;net">root<span>&#64;</span>example<span>&#46;</span>net</a>), I will monitor the /bin, /etc and /sbin
directories every 10 hours (if I was using the ssh_integrity_check_bsd, the
argument would be the directories as well):</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;agentless&gt;</span>
    <span class="nt">&lt;type&gt;</span>ssh_integrity_check_linux<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;frequency&gt;</span>36000<span class="nt">&lt;/frequency&gt;</span>
    <span class="nt">&lt;host&gt;</span>root@example.net<span class="nt">&lt;/host&gt;</span>
    <span class="nt">&lt;state&gt;</span>periodic<span class="nt">&lt;/state&gt;</span>
    <span class="nt">&lt;arguments&gt;</span>/bin /etc/ /sbin<span class="nt">&lt;/arguments&gt;</span>
<span class="nt">&lt;/agentless&gt;</span>
</pre></div>
</div>
<p>For my PIX, the configuration looks like:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;agentless&gt;</span>
    <span class="nt">&lt;type&gt;</span>ssh_pixconfig_diff<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;frequency&gt;</span>36000<span class="nt">&lt;/frequency&gt;</span>
    <span class="nt">&lt;host&gt;</span>pix@pix.fw.local<span class="nt">&lt;/host&gt;</span>
    <span class="nt">&lt;state&gt;</span>periodic_diff<span class="nt">&lt;/state&gt;</span>
<span class="nt">&lt;/agentless&gt;</span>
</pre></div>
</div>
<p>And just to exemplify the ssh_generic_diff I will also monitor ls -la /etc; cat
/etc/passwd on the <a class="reference external" href="mailto:root&#37;&#52;&#48;example&#46;net">root<span>&#64;</span>example<span>&#46;</span>net</a>. Note that if you want to monitor any network
firewall or switch, you can use the ssh_generic_diff and just specify the
commands in the arguments option. To use “su”, you need to set the value
“use_su” before the hostname (eg: &lt;host&gt;use_su <a class="reference external" href="mailto:root&#37;&#52;&#48;example">root<span>&#64;</span>example</a>.net&lt;/host&gt;).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;agentless&gt;</span>
    <span class="nt">&lt;type&gt;</span>ssh_generic_diff<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;frequency&gt;</span>36000<span class="nt">&lt;/frequency&gt;</span>
    <span class="nt">&lt;host&gt;</span>root@example.net<span class="nt">&lt;/host&gt;</span>
    <span class="nt">&lt;state&gt;</span>periodic_diff<span class="nt">&lt;/state&gt;</span>
    <span class="nt">&lt;arguments&gt;</span>ls -la /etc; cat /etc/passwd<span class="nt">&lt;/arguments&gt;</span>
<span class="nt">&lt;/agentless&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="running-the-completed-setup">
<h2>Running the completed setup<a class="headerlink" href="#running-the-completed-setup" title="Permalink to this headline">¶</a></h2>
<p>Once the configuration is completed, you can restart OpenArmor. You should see
something like “Started OpenArmor-agentlessd” in the output. Before each agentless
connection is started, OpenArmor will do a configuration check to make sure
everything is fine. Look at /var/OpenArmor/logs/OpenArmor.log for any error. If you see:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">2008/12/12 15:20:06 OpenArmor-agentlessd: ERROR: Expect command not found (or bad arguments) for &#39;ssh_integrity_check_bsd&#39;.</span>
<span class="go">2008/12/12 15:20:06 OpenArmor-agentlessd: ERROR: Test failed for &#39;ssh_integrity_check_bsd&#39; (127). Ignoring.&#39;</span>
</pre></div>
</div>
<p>It means that you don’t have the expect library installed on the server (it is
not necessary to install anything on the agentless systems to monitor). On
Ubuntu you can do the following to install:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>apt-get install expect
</pre></div>
</div>
<p>After installing expect, you can restart OpenArmor and you should see:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">2008/12/12 15:24:12 OpenArmor-agentlessd: INFO: Test passed for &#39;ssh_integrity_check_bsd&#39;.&#39;</span>
</pre></div>
</div>
<p>When it connects to the remote system, you will also see:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">2008/12/12 15:25:19 OpenArmor-agentlessd: INFO: ssh_integrity_check_bsd: root@example.net: Starting.</span>
<span class="go">2008/12/12 15:25:46 OpenArmor-agentlessd: INFO: ssh_integrity_check_bsd: root@example.net: Finished.</span>
</pre></div>
</div>
</div>
<div class="section" id="alerts">
<h2>Alerts<a class="headerlink" href="#alerts" title="Permalink to this headline">¶</a></h2>
<p>These are some of the alerts you will get:</p>
<p>For the ssh_generic_diff:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OpenArmor</span> <span class="n">HIDS</span> <span class="n">Notification</span><span class="o">.</span>
<span class="mi">2008</span> <span class="n">Dec</span> <span class="mi">12</span> <span class="mi">01</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">30</span>

<span class="n">Received</span> <span class="n">From</span><span class="p">:</span> <span class="p">(</span><span class="n">ssh_generic_diff</span><span class="p">)</span> <span class="n">root</span><span class="nd">@example</span><span class="o">.</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">agentless</span>
<span class="n">Rule</span><span class="p">:</span> <span class="mi">555</span> <span class="n">fired</span> <span class="p">(</span><span class="n">level</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Integrity checksum for agentless device changed.&quot;</span>
<span class="n">Portion</span> <span class="n">of</span> <span class="n">the</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>

<span class="n">OpenArmor</span><span class="p">:</span> <span class="n">agentless</span><span class="p">:</span> <span class="n">Change</span> <span class="n">detected</span><span class="p">:</span>
<span class="mi">35</span><span class="n">c35</span>
<span class="o">&lt;</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="n">r</span><span class="o">-</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">wheel</span> <span class="mi">34</span> <span class="n">Dec</span> <span class="mi">10</span> <span class="mi">03</span><span class="p">:</span><span class="mi">55</span> <span class="n">hosts</span><span class="o">.</span><span class="n">deny</span>
<span class="o">--</span>
<span class="o">&gt;</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="n">r</span><span class="o">-</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">wheel</span> <span class="mi">34</span> <span class="n">Dec</span> <span class="mi">11</span> <span class="mi">18</span><span class="p">:</span><span class="mi">23</span> <span class="n">hosts</span><span class="o">.</span><span class="n">deny</span>
<span class="o">-</span><span class="n">END</span> <span class="n">OF</span> <span class="n">NOTIFICATION</span>
</pre></div>
</div>
<p>For the PIX:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OpenArmor</span> <span class="n">HIDS</span> <span class="n">Notification</span><span class="o">.</span>
<span class="mi">2008</span> <span class="n">Dec</span> <span class="mi">01</span> <span class="mi">15</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">03</span>

<span class="n">Received</span> <span class="n">From</span><span class="p">:</span> <span class="p">(</span><span class="n">ssh_pixconfig_diff</span><span class="p">)</span> <span class="n">pix</span><span class="nd">@pix</span><span class="o">.</span><span class="n">fw</span><span class="o">.</span><span class="n">local</span><span class="o">-&gt;</span><span class="n">agentless</span>
<span class="n">Rule</span><span class="p">:</span> <span class="mi">555</span> <span class="n">fired</span> <span class="p">(</span><span class="n">level</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Integrity checksum for agentless device changed.&quot;</span>
<span class="n">Portion</span> <span class="n">of</span> <span class="n">the</span> <span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>

<span class="n">OpenArmor</span><span class="p">:</span> <span class="n">agentless</span><span class="p">:</span> <span class="n">Change</span> <span class="n">detected</span><span class="p">:</span>
<span class="mi">48</span><span class="n">c48</span>
<span class="o">&lt;</span> <span class="n">fixup</span> <span class="n">protocol</span> <span class="n">ftp</span> <span class="mi">21</span>
<span class="o">--</span>
<span class="o">&gt;</span> <span class="n">no</span> <span class="n">fixup</span> <span class="n">protocol</span> <span class="n">ftp</span> <span class="mi">21</span>
<span class="mi">100</span><span class="n">c100</span>
<span class="o">&lt;</span> <span class="n">ssh</span> <span class="n">timeout</span> <span class="mi">30</span>
<span class="o">--</span>
<span class="o">&gt;</span> <span class="n">ssh</span> <span class="n">timeout</span> <span class="mi">50</span>
<span class="n">More</span> <span class="n">changes</span><span class="o">..</span>

<span class="o">-</span><span class="n">END</span> <span class="n">OF</span> <span class="n">NOTIFICATION</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2021, OpenArmor Project Team.<br/>
    OpenArmor <b>OpenArmor.net</b> domain owned and maintained by <a href="https://theopenarmor.org" target="_blank">OpenArmor Foundation</a><br/>
    Home page graphics courtesy of <a href="https://pixabay.com" target="_blank">pixabay</a>
    </p>
  </div>
</footer>
  </body>
</html>