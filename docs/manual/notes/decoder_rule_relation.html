<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Question: How does the decoder.xml relate to the rules? &#8212; OpenArmor
    </title>
    <link
      rel="stylesheet"
      href="../../../_static/pygments.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../../_static/bootstrap-sphinx.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../../_static/bootstrap-3.2.0/css/bootstrap.min.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../../_static/bootstrap-3.2.0/css/bootstrap-theme.min.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../../_static/bootstrap-sphinx.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../../_static/parallax.css"
      type="text/css"
    />
    <script
      id="documentation_options"
      data-url_root="../../../"
      src="../../../_static/documentation_options.js"
    ></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script src="../../../_static/js/jquery-fix.js"></script>
    <script src="../../../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script src="../../../_static/bootstrap-sphinx.js"></script>
    <link
      rel="author"
      title="About these documents"
      href="../../../about.html"
    />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-138780766-1"
    ></script>

    <link rel="icon" href="favicon/favicon.ico" type="image/x-icon" />
  </head>
  <body>
    <div id="navbar" class="navbar navbar-inverse navbar-default">
      <div class="container">
        <div class="navbar-header">
          <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
          <button
            type="button"
            class="navbar-toggle"
            data-toggle="collapse"
            data-target=".nav-collapse"
          >
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../../index.html"
            ><img src="../../../_static/OpenArmor_logo_bare_small.jpg" />
            OpenArmor</a
          >
          <span class="navbar-text navbar-version pull-left"><b>3.6.0</b></span>
        </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li><a href="https://theopenarmor.org/about/">About</a></li>
            <li><a href="https://theopenarmor.org/docs/">Documentation</a></li>
            <li>
              <a href="https://theopenarmor.org/register-for-OpenArmor/"
                >Get OpenArmor+</a
              >
            </li>
            <li><a href="https://theopenarmor.org/downloads/">Downloads</a></li>

            <li class="dropdown globaltoc-container">
              <a
                role="button"
                id="dLabelGlobalToc"
                data-toggle="dropdown"
                data-target="#"
                href="../../../index.html"
                >Site <b class="caret"></b
              ></a>
              <ul
                class="dropdown-menu globaltoc"
                role="menu"
                aria-labelledby="dLabelGlobalToc"
              >
                <ul>
                  <li class="toctree-l1">
                    <a class="reference internal" href="../index.html"
                      >Manual</a
                    >
                  </li>
                </ul>
                <ul>
                  <li class="toctree-l1">
                    <a class="reference internal" href="../../faq/index.html"
                      >Frequently asked questions</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../../cookbooks/index.html"
                      >User submitted Cookbooks</a
                    >
                  </li>
                </ul>
                <ul>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../../development/build/index.html"
                      >Build, compile, and not much more</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../../development/oRFC/index.html"
                      >oRFC:</a
                    >
                  </li>
                </ul>
                <ul>
                  <li class="toctree-l1">
                    <a class="reference internal" href="../../syntax/index.html"
                      >Syntax and Options</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../../formats/index.html"
                      >Output Formats</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../../programs/index.html"
                      >Man pages</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../../examples/index.html"
                      >Examples</a
                    >
                  </li>
                </ul>
              </ul>
            </li>
          </ul>

          <form
            class="navbar-form navbar-right"
            action="../../../search.html"
            method="get"
          >
            <div class="form-group">
              <input
                type="text"
                name="q"
                class="form-control"
                placeholder="Search"
              />
            </div>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div
            class="section"
            id="question-how-does-the-decoder-xml-relate-to-the-rules"
          >
            <h1>
              Question: How does the decoder.xml relate to the rules?<a
                class="headerlink"
                href="#question-how-does-the-decoder-xml-relate-to-the-rules"
                title="Permalink to this headline"
                >¶</a
              >
            </h1>
            <div class="section" id="answer">
              <h2>
                Answer:<a
                  class="headerlink"
                  href="#answer"
                  title="Permalink to this headline"
                  >¶</a
                >
              </h2>
              <p>
                The decoder.xml file can be used to capture certain bits of
                information from the logs that OpenArmor is monitoring. These
                bits of information can be passed to rules as XML objects. Take
                for example, the pair of rules below:
              </p>
              <div class="highlight-console notranslate">
                <div class="highlight">
                  <pre><span></span><span class="go">&lt;rule id=&quot;3100&quot; level=&quot;0&quot;&gt;</span>
<span class="go">  &lt;decoded_as&gt;web-accesslog&lt;/decoded_as&gt;</span>
<span class="go">  &lt;category&gt;web-log&lt;/category&gt;</span>
<span class="go">  &lt;description&gt;Access log messages grouped.&lt;/description&gt;</span>
<span class="go">&lt;/rule&gt;</span>

<span class="go">&lt;rule id=&quot;3101&quot; level=&quot;5&quot;&gt;</span>
<span class="go">  &lt;if_sid&gt;3100&lt;/if_sid&gt;</span>
<span class="go">  &lt;id&gt;^40&lt;/id&gt;</span>
<span class="go">  &lt;description&gt;Web server 400 error code.&lt;/description&gt;</span>
<span class="go">&lt;/rule&gt;</span>
</pre>
                </div>
              </div>
              <p>
                The first rule acts as a “collector” for specific log messages.
                As part of the rule construct, the
                <code class="docutils literal notranslate"
                  ><span class="pre"
                    >&lt;decoded_as&gt;&lt;/decoded_as&gt;</span
                  ></code
                >
                tags are used to determine how the log entry will be decoded,
                and aspects of it captured. In this case, it will be a
                web-accesslog. The corresponding construct in decoder.xml (shown
                below) matches the log entry and captures certain parts of the
                entry to be used later.
              </p>
              <div class="highlight-console notranslate">
                <div class="highlight">
                  <pre><span></span><span class="go">&lt;decoder name=&quot;web-accesslog&quot;&gt;</span>
<span class="go">  &lt;type&gt;web-log&lt;/type&gt;</span>
<span class="go">  &lt;prematch&gt;^\S+ - &lt;/prematch&gt;</span>
<span class="go">  &lt;regex&gt;^(\S+) - \S+ [\S+ -\d+] &lt;/regex&gt;</span>
<span class="go">  &lt;regex&gt;&quot;\w+ (\S+) HTTP\S+ (\d+) &lt;/regex&gt;</span>
<span class="go">  &lt;order&gt;srcip,url,id&lt;/order&gt;</span>
<span class="go">&lt;/decoder&gt;</span>
</pre>
                </div>
              </div>
              <p>
                Looking at the regular expression we can see that the source IP,
                the URL, and the HTTP Result Code are captured. The first set of
                parentheses denotes that this part of the expression is the
                source IP, the second set denotes the URL, and the last set is
                the ID code, which for the example is the HTTP result code.
                Going back to the second rule above, its construct contains the
                <code class="docutils literal notranslate"
                  ><span class="pre">&lt;id&gt;&lt;/id&gt;</span></code
                >
                tags, which, in this case (rule #3101), is used to match a 400
                HTTP result code. Something else worth noting is the multiple
                &lt;regex&gt; tags in this example. This is simply done to
                provide enhanced clarity and preventing lines over 80
                characters. The values inside both tags are concatenated before
                being processed by OpenArmor.
              </p>
              <p>
                These regex variables can also be passed to active-response
                command constructs like the one show below:
              </p>
              <div class="highlight-console notranslate">
                <div class="highlight">
                  <pre><span></span><span class="go">&lt;command&gt;</span>
<span class="go">  &lt;name&gt;host-deny&lt;/name&gt;</span>
<span class="go">  &lt;executable&gt;host-deny.sh&lt;/executable&gt;</span>
<span class="go">  &lt;expect&gt;srcip&lt;/expect&gt;</span>
<span class="go">  &lt;timeout_allowed&gt;yes&lt;/timeout_allowed&gt;</span>
<span class="go">&lt;/command&gt;</span>
</pre>
                </div>
              </div>
              <p>
                The
                <code class="docutils literal notranslate"
                  ><span class="pre">&lt;expect&gt;&lt;/expect&gt;</span></code
                >
                tags are used here to specify which variable is expected as an
                argument to the executable being used for the active-response
                action. A list of available variables is shown below:
              </p>
              <ul class="simple">
                <li><p>location</p></li>
                <li><p>hostname</p></li>
                <li><p>log_tag</p></li>
                <li><p>srcip</p></li>
                <li><p>dstip</p></li>
                <li><p>srcport</p></li>
                <li><p>dstport</p></li>
                <li><p>protocol</p></li>
                <li><p>action</p></li>
                <li><p>user</p></li>
                <li><p>dstuser</p></li>
                <li><p>id</p></li>
                <li><p>command</p></li>
                <li><p>url</p></li>
                <li><p>data</p></li>
              </ul>
              <p>
                Not all of these will be available for every decoder type, but
                you can check the decoder.xml to see which ones are available
                for which decoders.
              </p>
              <div class="admonition note">
                <p class="admonition-title">Note</p>
                <p>
                  If you are creating custom rules to monitor logs, almost all
                  of your editing will occur in the rules files. The decoder.xml
                  is just another way to make your rules more powerful, pass
                  specific information to your active-response commands.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p class="pull-right">
          <a href="#">Back to top</a>
        </p>
        <p>
          &copy; Copyright 2010-2021, OpenArmor Project Team.<br />
          OpenArmor <b>OpenArmor.net</b> domain owned and maintained by
          <a href="https://theopenarmor.org" target="_blank"
            >OpenArmor Foundation</a
          ><br />
          Home page graphics courtesy of
          <a href="https://pixabay.com" target="_blank">pixabay</a>
        </p>
      </div>
    </footer>
  </body>
</html>
