<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>When the unexpected happens: FAQ &#8212; OpenArmor</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link
      rel="stylesheet"
      href="../../_static/bootstrap-sphinx.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../_static/bootstrap-3.2.0/css/bootstrap.min.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../_static/bootstrap-3.2.0/css/bootstrap-theme.min.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../_static/bootstrap-sphinx.css"
      type="text/css"
    />
    <link rel="stylesheet" href="../../_static/parallax.css" type="text/css" />
    <script
      id="documentation_options"
      data-url_root="../../"
      src="../../_static/documentation_options.js"
    ></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script src="../../_static/js/jquery-fix.js"></script>
    <script src="../../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link
      rel="next"
      title="User submitted Cookbooks"
      href="../cookbooks/index.html"
    />
    <link rel="prev" title="Syscheck: FAQ" href="syscheck.html" />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-138780766-1"
    ></script>

    <link rel="icon" href="favicon/favicon.ico" type="image/x-icon" />
  </head>
  <body>
    <div id="navbar" class="navbar navbar-inverse navbar-default">
      <div class="container">
        <div class="navbar-header">
          <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
          <button
            type="button"
            class="navbar-toggle"
            data-toggle="collapse"
            data-target=".nav-collapse"
          >
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html"
            ><img src="../../_static/OpenArmor_logo_bare_small.jpg" />
            OpenArmor</a
          >
          <span class="navbar-text navbar-version pull-left"><b>3.6.0</b></span>
        </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li><a href="https://theopenarmor.org/about/">About</a></li>
            <li><a href="https://theopenarmor.org/docs/">Documentation</a></li>
            <li>
              <a href="https://theopenarmor.org/register-for-OpenArmor/"
                >Get OpenArmor+</a
              >
            </li>
            <li><a href="https://theopenarmor.org/downloads/">Downloads</a></li>

            <li class="dropdown globaltoc-container">
              <a
                role="button"
                id="dLabelGlobalToc"
                data-toggle="dropdown"
                data-target="#"
                href="../../index.html"
                >Site <b class="caret"></b
              ></a>
              <ul
                class="dropdown-menu globaltoc"
                role="menu"
                aria-labelledby="dLabelGlobalToc"
              >
                <ul>
                  <li class="toctree-l1">
                    <a class="reference internal" href="../manual/index.html"
                      >Manual</a
                    >
                  </li>
                </ul>
                <ul class="current">
                  <li class="toctree-l1 current">
                    <a class="reference internal" href="index.html"
                      >Frequently asked questions</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a class="reference internal" href="../cookbooks/index.html"
                      >User submitted Cookbooks</a
                    >
                  </li>
                </ul>
                <ul>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../development/build/index.html"
                      >Build, compile, and not much more</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../development/oRFC/index.html"
                      >oRFC:</a
                    >
                  </li>
                </ul>
                <ul>
                  <li class="toctree-l1">
                    <a class="reference internal" href="../syntax/index.html"
                      >Syntax and Options</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a class="reference internal" href="../formats/index.html"
                      >Output Formats</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a class="reference internal" href="../programs/index.html"
                      >Man pages</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a class="reference internal" href="../examples/index.html"
                      >Examples</a
                    >
                  </li>
                </ul>
              </ul>
            </li>

            <li>
              <a href="syscheck.html" title="Previous Chapter: Syscheck: FAQ"
                ><span
                  class="glyphicon glyphicon-chevron-left visible-sm"
                ></span
                ><span class="hidden-sm hidden-tablet"
                  >&laquo; Syscheck: FAQ</span
                >
              </a>
            </li>
            <li>
              <a
                href="../cookbooks/index.html"
                title="Next Chapter: User submitted Cookbooks"
                ><span
                  class="glyphicon glyphicon-chevron-right visible-sm"
                ></span
                ><span class="hidden-sm hidden-tablet"
                  >User submitte... &raquo;</span
                >
              </a>
            </li>
          </ul>

          <form
            class="navbar-form navbar-right"
            action="../../search.html"
            method="get"
          >
            <div class="form-group">
              <input
                type="text"
                name="q"
                class="form-control"
                placeholder="Search"
              />
            </div>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="section" id="when-the-unexpected-happens-faq">
            <span id="faq-unexpected"></span>
            <h1>
              When the unexpected happens: FAQ<a
                class="headerlink"
                href="#when-the-unexpected-happens-faq"
                title="Permalink to this headline"
                >¶</a
              >
            </h1>
            <div class="contents local topic" id="contents">
              <ul class="simple">
                <li>
                  <p>
                    <a
                      class="reference internal"
                      href="#how-do-i-troubleshoot-OpenArmor"
                      id="id1"
                      >How do I troubleshoot OpenArmor?</a
                    >
                  </p>
                </li>
                <li>
                  <p>
                    <a
                      class="reference internal"
                      href="#how-to-debug-OpenArmor"
                      id="id2"
                      >How to debug OpenArmor?</a
                    >
                  </p>
                </li>
                <li>
                  <p>
                    <a
                      class="reference internal"
                      href="#the-communication-between-my-agent-and-the-server-is-not-working-what-to-do"
                      id="id3"
                      >The communication between my agent and the server is not
                      working. What to do?</a
                    >
                  </p>
                </li>
                <li>
                  <p>
                    <a
                      class="reference internal"
                      href="#what-does-1403-incorrectly-formated-message-means"
                      id="id4"
                      >What does “1403 - Incorrectly formated message” means?</a
                    >
                  </p>
                </li>
                <li>
                  <p>
                    <a
                      class="reference internal"
                      href="#what-does-1210-queue-not-accessible-mean"
                      id="id5"
                      >What does “1210 - Queue not accessible?” mean?</a
                    >
                  </p>
                  <ul>
                    <li>
                      <p>
                        <a
                          class="reference internal"
                          href="#check-queue-OpenArmor-queue"
                          id="id6"
                          >Check queue/OpenArmor/queue</a
                        >
                      </p>
                    </li>
                    <li>
                      <p>
                        <a
                          class="reference internal"
                          href="#check-queue-alerts-ar"
                          id="id7"
                          >Check queue/alerts/ar</a
                        >
                      </p>
                    </li>
                  </ul>
                </li>
                <li>
                  <p>
                    <a
                      class="reference internal"
                      href="#remote-commands-are-not-accepted-from-the-manager-ignoring-it-on-the-agent-conf"
                      id="id8"
                      >Remote commands are not accepted from the manager.
                      Ignoring it on the agent.conf</a
                    >
                  </p>
                </li>
                <li>
                  <p>
                    <a
                      class="reference internal"
                      href="#errors-when-dealing-with-multiple-agents"
                      id="id9"
                      >Errors when dealing with multiple agents</a
                    >
                  </p>
                </li>
                <li>
                  <p>
                    <a
                      class="reference internal"
                      href="#fixing-duplicate-errors"
                      id="id10"
                      >Fixing Duplicate Errors</a
                    >
                  </p>
                </li>
                <li>
                  <p>
                    <a
                      class="reference internal"
                      href="#agent-won-t-connect-to-the-manager-or-the-agent-always-shows-never-connected"
                      id="id11"
                      >Agent won’t connect to the manager or the agent always
                      shows never connected</a
                    >
                  </p>
                </li>
                <li>
                  <p>
                    <a
                      class="reference internal"
                      href="#i-am-seeing-high-cpu-utilization-on-a-windows-agent"
                      id="id12"
                      >I am seeing high CPU utilization on a Windows agent</a
                    >
                  </p>
                </li>
                <li>
                  <p>
                    <a
                      class="reference internal"
                      href="#my-etc-hosts-deny-file-is-blank-after-install-2-8-1"
                      id="id13"
                      >My /etc/hosts.deny file is blank after install 2.8.1!</a
                    >
                  </p>
                </li>
              </ul>
            </div>
            <div class="section" id="how-do-i-troubleshoot-OpenArmor">
              <h2>
                <a class="toc-backref" href="#id1"
                  >How do I troubleshoot OpenArmor?</a
                ><a
                  class="headerlink"
                  href="#how-do-i-troubleshoot-OpenArmor"
                  title="Permalink to this headline"
                  >¶</a
                >
              </h2>
              <blockquote>
                <div>
                  <p>
                    If you are having problems with OpenArmor, the first thing
                    to do is to look at your logs.
                  </p>
                  <ul class="simple">
                    <li>
                      <p>
                        Unix/Linux: The logs will be at
                        /var/OpenArmor/logs/OpenArmor.log
                      </p>
                    </li>
                    <li>
                      <p>
                        Windows: The logs are at C:Program
                        FilesOpenArmor-agentOpenArmor.log.
                      </p>
                    </li>
                  </ul>
                  <p>
                    If by looking at them, you can’t find out the error, we
                    suggest you to send an e-mail to one of our mailing lists
                    with the following information:
                  </p>
                  <ul>
                    <li>
                      <p>OpenArmor version number.</p>
                      <blockquote>
                        <div>
                          <p>
                            Run the following to get the version installation.
                          </p>
                          <div class="highlight-console notranslate">
                            <div class="highlight">
                              <pre><span></span><span class="gp"># </span>/var/OpenArmor/bin/OpenArmor-analysisd -V
</pre>
                            </div>
                          </div>
                        </div>
                      </blockquote>
                    </li>
                    <li><p>Content of /etc/OpenArmor-init.conf</p></li>
                    <li>
                      <p>
                        Content of /var/OpenArmor/etc/OpenArmor.conf or (or
                        C:Program FilesOpenArmor-agentOpenArmor.log if Windows)
                      </p>
                    </li>
                    <li><p>Content of /var/OpenArmor/logs/OpenArmor.log</p></li>
                    <li>
                      <p>Operating system name/version (uname -a if Unix)</p>
                    </li>
                    <li><p>Any other relevant information.</p></li>
                  </ul>
                </div>
              </blockquote>
            </div>
            <div class="section" id="how-to-debug-OpenArmor">
              <h2>
                <a class="toc-backref" href="#id2">How to debug OpenArmor?</a
                ><a
                  class="headerlink"
                  href="#how-to-debug-OpenArmor"
                  title="Permalink to this headline"
                  >¶</a
                >
              </h2>
              <blockquote>
                <div>
                  <div class="admonition warning">
                    <p class="admonition-title">Warning</p>
                    <p>
                      Only read this section if you tried to troubleshoot
                      OpenArmor already, but didn’t have lucky solving your
                      problem. Most of the users will never need to enable
                      debugging, since it can significantly hurt performance.
                    </p>
                  </div>
                  <p><strong>Debug Logging</strong></p>
                  <p>
                    You can also enable debugging mode on OpenArmor to extract
                    more data about what is going on. To do so, you will need to
                    modify the file /var/OpenArmor/etc/internal_options.conf (or
                    C:\Program Files\OpenArmor-agent\internal_options.conf on
                    Windows) and change the debug level from the default “0” to
                    “1” or “2”.
                  </p>
                  <p>
                    For example, if you wish to debug your windows agent, just
                    change the option windows.debug from 0 to 2. Bellow is the
                    list of all the debug options:
                  </p>
                  <div class="highlight-console notranslate">
                    <div class="highlight">
                      <pre><span></span><span class="gp"># </span>Debug options.
<span class="gp"># </span>Debug <span class="m">0</span> -&gt; no debug
<span class="gp"># </span>Debug <span class="m">1</span> -&gt; first level of debug
<span class="gp"># </span>Debug <span class="m">2</span> -&gt; full debugging

<span class="gp"># </span>Windows debug <span class="o">(</span>used by the windows agent<span class="o">)</span>
<span class="go">windows.debug=0</span>

<span class="gp"># </span>Syscheck <span class="o">(</span>local, server and unix agent<span class="o">)</span>
<span class="go">syscheck.debug=0</span>

<span class="gp"># </span>Remoted <span class="o">(</span>server debug<span class="o">)</span>
<span class="go">remoted.debug=0</span>

<span class="gp"># </span>Analysisd <span class="o">(</span>server or <span class="nb">local</span><span class="o">)</span>
<span class="go">analysisd.debug=0</span>

<span class="gp"># </span>Log collector <span class="o">(</span>server, <span class="nb">local</span> or unix agent<span class="o">)</span>
<span class="go">logcollector.debug=0</span>

<span class="gp"># </span>Unix agentd
<span class="go">agent.debug=0</span>
</pre>
                    </div>
                  </div>
                  <p>
                    If this is on an OpenArmor server you can enable debug by
                    running:
                  </p>
                  <div class="highlight-console notranslate">
                    <div class="highlight">
                      <pre><span></span><span class="gp"># </span>/var/OpenArmor/bin/OpenArmor-control <span class="nb">enable</span> debug
</pre>
                    </div>
                  </div>
                  <p>
                    Enable debug mode and restart the OpenArmor processes to
                    view more verbose logs.
                  </p>
                  <p><strong>Getting more log data</strong></p>
                  <p>
                    If you are up to editing the source and recompiling, you can
                    use the verbose() function to add entries to the log. This
                    has been helpful on at least one occasion to help pinpoint
                    where a problem was occurring. Something along these lines
                    should work (at least in 1.3):
                  </p>
                  <div class="highlight-c notranslate">
                    <div class="highlight">
                      <pre><span></span><span class="n">verbose</span><span class="p">(</span><span class="s">&quot;MyName: inside the_file.c the_function() %s ..&quot;</span><span class="p">,</span> <span class="n">the_string</span><span class="p">);</span>
</pre>
                    </div>
                  </div>
                  <ul class="simple">
                    <li>
                      <p>
                        If you tag all your extra logs with something, MyName,
                        in this example, they stand out better.
                      </p>
                    </li>
                    <li>
                      <p>
                        If you need to get information from several source
                        files, including the file name the_file.c, in this
                        example is helpful.
                      </p>
                    </li>
                    <li>
                      <p>
                        You will almost surely want information from more than
                        one function, including the name, the_function() will
                        show which function sent the log.
                      </p>
                    </li>
                    <li>
                      <p>
                        Finally, you can include a variable string with the
                        printf format specifier %s in the log entry and
                        the_string is the name of the string variable to send to
                        the log.
                      </p>
                    </li>
                  </ul>
                  <p>
                    With some calls to verbose, recompile and replace the stock
                    binary with your edited one. Restart OpenArmor and tail the
                    log.
                  </p>
                </div>
              </blockquote>
            </div>
            <div
              class="section"
              id="the-communication-between-my-agent-and-the-server-is-not-working-what-to-do"
            >
              <span id="faq-unexpected-comm"></span>
              <h2>
                <a class="toc-backref" href="#id3"
                  >The communication between my agent and the server is not
                  working. What to do?</a
                ><a
                  class="headerlink"
                  href="#the-communication-between-my-agent-and-the-server-is-not-working-what-to-do"
                  title="Permalink to this headline"
                  >¶</a
                >
              </h2>
              <blockquote>
                <div>
                  <p>
                    There are multiple reasons for it to happen. First, you
                    should look at your agent and server logs to see what they
                    say. If you don’t know where they are, go to our
                    Troubleshooting page for more information.
                  </p>
                  <p>
                    In addition to that, follow the step by step at the end, if
                    you need to add/re-add the authentication keys.
                  </p>
                  <p>
                    <strong
                      >There is a firewall between the agent and the
                      server.</strong
                    >
                  </p>
                  <p>If you have the following message on the agent log:</p>
                  <div class="highlight-console notranslate">
                    <div class="highlight">
                      <pre><span></span><span class="go">2007/04/19 12:42:54 OpenArmor-agentd(4101): Waiting for server reply (not started).</span>
<span class="go">2007/04/19 12:43:10 OpenArmor-agentd(4101): Waiting for server reply (not started).</span>
<span class="go">2007/04/19 12:43:41 OpenArmor-agentd(4101): Waiting for server reply (not started).</span>
<span class="go">2007/04/19 12:44:27 OpenArmor-agentd(4101): Waiting for server reply (not started).</span>
</pre>
                    </div>
                  </div>
                  <p>
                    And nothing on the server log, you probably have a firewall
                    between the two devices. Make sure to open port 1514 UDP
                    between them (keeping state –the agent connects to the
                    server and expects a reply back).
                  </p>
                  <div class="admonition note">
                    <p class="admonition-title">Note</p>
                    <p>
                      The way the agent/server communication works is that the
                      agent starts a connection to the server using any random
                      high port. So, the only port that OpenArmor opens is in
                      the server side (port 1514 UDP). It works similar to DNS,
                      where the DNS client connects to UDP port 53 and expects a
                      reply back.
                    </p>
                  </div>
                  <p>
                    <strong
                      >Wrong authentication keys configured (you imported a key
                      from a different agent).</strong
                    >
                  </p>
                  <p>
                    If that’s the case, you would be getting logs similar to the
                    above on the agent and the following on the server (see also
                    Errors:1403):
                  </p>
                  <div class="highlight-console notranslate">
                    <div class="highlight">
                      <pre><span></span><span class="go">2007/05/23 09:27:35 OpenArmor-remoted(1403): Incorrectly formated message from &#39;xxx.xxx.xxx.xxx&#39;.</span>
<span class="go">2007/05/23 09:27:35 OpenArmor-remoted(1403): Incorrectly formated message from &#39;xxx.xxx.xxx.xxx&#39;.&#39;&#39;</span>
</pre>
                    </div>
                  </div>
                  <p>
                    <strong
                      >The IP address you configured the agent is different from
                      what the server is seeing.</strong
                    >
                  </p>
                  <p>Same as above (see also see Errors:1403).</p>
                  <p>
                    <strong
                      >Step by Step – adding the authentication keys</strong
                    >
                  </p>
                  <p>
                    For most of the errors (except the firewall issue), removing
                    and re-adding the authentication keys fix the problem. Do
                    the following if you are having issues:
                  </p>
                  <ol class="arabic">
                    <li>
                      <p>‘Stop the server and the agent.’</p>
                      <blockquote>
                        <div>
                          <ul class="simple">
                            <li>
                              <p>
                                Make sure they are really stopped (ps on Unix or
                                sc query OpenArmorsvc on Windows)
                              </p>
                            </li>
                          </ul>
                        </div>
                      </blockquote>
                    </li>
                    <li>
                      <p>
                        Run the manage-agents tool on the server and remove the
                        agent.
                      </p>
                    </li>
                    <li>
                      <p>
                        Still on the server, add the agent using manage-agents.
                        Make sure the IP is correct.
                      </p>
                    </li>
                    <li><p>Start the server.</p></li>
                    <li>
                      <p>
                        Run manage-agents on the agent and import the newly
                        generated key.
                      </p>
                    </li>
                    <li><p>Start the agent.</p></li>
                  </ol>
                  <p>
                    If after that, it still doesn’t work, contact our mailing
                    list for help.
                  </p>
                </div>
              </blockquote>
            </div>
            <div
              class="section"
              id="what-does-1403-incorrectly-formated-message-means"
            >
              <h2>
                <a class="toc-backref" href="#id4"
                  >What does “1403 - Incorrectly formated message” means?</a
                ><a
                  class="headerlink"
                  href="#what-does-1403-incorrectly-formated-message-means"
                  title="Permalink to this headline"
                  >¶</a
                >
              </h2>
              <p>
                It means that the server (or agent) wasn’t able to decrypt the
                message from the other side of the connection. See
                <a
                  class="reference internal"
                  href="#the-communication-between-my-agent-and-the-server-is-not-working-what-to-do"
                  >The communication between my agent and the server is not
                  working. What to do?</a
                >
              </p>
              <p>The main reasons for this to happen are:</p>
              <ul class="simple">
                <li>
                  <p>
                    Wrong authentication keys configured (you imported a key
                    from a different agent).
                  </p>
                </li>
                <li>
                  <p>
                    The IP address you configured the agent is different from
                    what the server is seeing.
                  </p>
                </li>
              </ul>
              <p>How to fix it:</p>
              <ul class="simple">
                <li>
                  <p>
                    Check if you imported the right authentication keys into the
                    agent.
                  </p>
                </li>
                <li><p>Check if the IP address is correctly.</p></li>
                <li>
                  <p>
                    You can also try to remove the agent (using manage_agents),
                    add it back again and re-import the keys into the agent.
                    Make sure to restart the server (first) and then the agent
                    after that.
                  </p>
                </li>
              </ul>
            </div>
            <div class="section" id="what-does-1210-queue-not-accessible-mean">
              <h2>
                <a class="toc-backref" href="#id5"
                  >What does “1210 - Queue not accessible?” mean?</a
                ><a
                  class="headerlink"
                  href="#what-does-1210-queue-not-accessible-mean"
                  title="Permalink to this headline"
                  >¶</a
                >
              </h2>
              <div class="section" id="check-queue-OpenArmor-queue">
                <h3>
                  <a class="toc-backref" href="#id6"
                    >Check queue/OpenArmor/queue</a
                  ><a
                    class="headerlink"
                    href="#check-queue-OpenArmor-queue"
                    title="Permalink to this headline"
                    >¶</a
                  >
                </h3>
                <p>
                  If you have logs similar to the following in
                  <code class="docutils literal notranslate"
                    ><span class="pre"
                      >/var/OpenArmor/queue/OpenArmor/queue</span
                    ></code
                  >:
                </p>
                <div class="highlight-default notranslate">
                  <div class="highlight">
                    <pre><span></span><span class="mi">2008</span><span class="o">/</span><span class="mi">04</span><span class="o">/</span><span class="mi">29</span> <span class="mi">15</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">39</span> <span class="n">OpenArmor</span><span class="o">-</span><span class="n">syscheckd</span><span class="p">(</span><span class="mi">1210</span><span class="p">):</span> <span class="n">ERROR</span><span class="p">:</span> <span class="n">Queue</span> <span class="s1">&#39;/var/OpenArmor/queue/OpenArmor/queue&#39;</span> <span class="ow">not</span> <span class="n">accessible</span><span class="p">:</span> <span class="s1">&#39;Connection refused&#39;</span><span class="o">.</span>
<span class="mi">2008</span><span class="o">/</span><span class="mi">04</span><span class="o">/</span><span class="mi">29</span> <span class="mi">15</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">39</span> <span class="n">OpenArmor</span><span class="o">-</span><span class="n">rootcheck</span><span class="p">(</span><span class="mi">1210</span><span class="p">):</span> <span class="n">ERROR</span><span class="p">:</span> <span class="n">Queue</span> <span class="s1">&#39;/var/OpenArmor/queue/OpenArmor/queue&#39;</span> <span class="ow">not</span> <span class="n">accessible</span><span class="p">:</span> <span class="s1">&#39;Connection refused&#39;</span><span class="o">.</span>
<span class="mi">2008</span><span class="o">/</span><span class="mi">04</span><span class="o">/</span><span class="mi">29</span> <span class="mi">15</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">45</span> <span class="n">OpenArmor</span><span class="o">-</span><span class="n">logcollector</span><span class="p">(</span><span class="mi">1210</span><span class="p">):</span> <span class="n">ERROR</span><span class="p">:</span> <span class="n">Queue</span> <span class="s1">&#39;/var/OpenArmor/queue/OpenArmor/queue&#39;</span> <span class="ow">not</span> <span class="n">accessible</span><span class="p">:</span> <span class="s1">&#39;Connection refused&#39;</span><span class="o">.</span>
<span class="mi">2008</span><span class="o">/</span><span class="mi">04</span><span class="o">/</span><span class="mi">29</span> <span class="mi">15</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">45</span> <span class="n">OpenArmor</span><span class="o">-</span><span class="n">logcollector</span><span class="p">(</span><span class="mi">1211</span><span class="p">):</span> <span class="n">ERROR</span><span class="p">:</span> <span class="n">Unable</span> <span class="n">to</span> <span class="n">access</span> <span class="n">queue</span><span class="p">:</span> <span class="s1">&#39;/var/OpenArmor/queue/OpenArmor/queue&#39;</span><span class="o">.</span> <span class="n">Giving</span> <span class="n">up</span><span class="o">..</span>
<span class="mi">2008</span><span class="o">/</span><span class="mi">04</span><span class="o">/</span><span class="mi">29</span> <span class="mi">15</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">00</span> <span class="n">OpenArmor</span><span class="o">-</span><span class="n">syscheckd</span><span class="p">(</span><span class="mi">1210</span><span class="p">):</span> <span class="n">ERROR</span><span class="p">:</span> <span class="n">Queue</span> <span class="s1">&#39;/var/OpenArmor/queue/OpenArmor/queue&#39;</span> <span class="ow">not</span> <span class="n">accessible</span><span class="p">:</span> <span class="s1">&#39;Connection refused&#39;</span><span class="o">.</span>
<span class="mi">2008</span><span class="o">/</span><span class="mi">04</span><span class="o">/</span><span class="mi">29</span> <span class="mi">15</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">00</span> <span class="n">OpenArmor</span><span class="o">-</span><span class="n">rootcheck</span><span class="p">(</span><span class="mi">1211</span><span class="p">):</span> <span class="n">ERROR</span><span class="p">:</span> <span class="n">Unable</span> <span class="n">to</span> <span class="n">access</span> <span class="n">queue</span><span class="p">:</span> <span class="s1">&#39;/var/OpenArmor/queue/OpenArmor/queue&#39;</span><span class="o">.</span> <span class="n">Giving</span> <span class="n">up</span><span class="o">..</span>
</pre>
                  </div>
                </div>
                <p>
                  It means that
                  <a
                    class="reference internal"
                    href="../programs/OpenArmor-analysisd.html#OpenArmor-analysisd"
                    ><span class="std std-ref">OpenArmor-analysisd</span></a
                  >
                  is not running for some reason.
                </p>
                <p><strong>The main reasons for this to happen are:</strong></p>
                <ul class="simple">
                  <li>
                    <p>
                      <a
                        class="reference internal"
                        href="../programs/OpenArmor-analysisd.html#OpenArmor-analysisd"
                        ><span class="std std-ref">OpenArmor-analysisd</span></a
                      >
                      didn’t start properly. Look at the logs for any error from
                      it.
                    </p>
                  </li>
                  <li>
                    <p>
                      <a
                        class="reference internal"
                        href="../programs/OpenArmor-analysisd.html#OpenArmor-analysisd"
                        ><span class="std std-ref">OpenArmor-analysisd</span></a
                      >
                      didn’t start at all. There is a bug in the init scripts
                      that during system reboot, it may not start if the PID is
                      already in use (we are working to fix it).
                    </p>
                  </li>
                  <li>
                    <p>
                      <a
                        class="reference internal"
                        href="../programs/OpenArmor-analysisd.html#OpenArmor-analysisd"
                        ><span class="std std-ref">OpenArmor-analysisd</span></a
                      >
                      cannot access
                      <code class="docutils literal notranslate"
                        ><span class="pre">/queue/fts/fts-queue</span></code
                      >. Look for the error message
                      <code class="docutils literal notranslate"
                        ><span class="pre">OpenArmor-analysisd(1103):</span>
                        <span class="pre">ERROR:</span>
                        <span class="pre">Unable</span>
                        <span class="pre">to</span>
                        <span class="pre">open</span>
                        <span class="pre">file</span>
                        <span class="pre">'/queue/fts/fts-queue'.</span></code
                      >
                      This can be fixed by ensuring that the OpenArmor user owns
                      <code class="docutils literal notranslate"
                        ><span class="pre"
                          >/var/OpenArmor/queue/fts/fts-queue</span
                        ></code
                      >.
                    </p>
                  </li>
                </ul>
                <p><strong>How to fix it:</strong></p>
                <p>Stop OpenArmor and start it back again:</p>
                <div class="highlight-console notranslate">
                  <div class="highlight">
                    <pre><span></span><span class="gp"># </span>/var/OpenArmor/bin/OpenArmor-control stop
<span class="gp gp-VirtualEnv">(you can also check at /var/OpenArmor/var/run that there is not PID file in there)</span>
<span class="gp"># </span>/var/OpenArmor/bin/OpenArmor-control start
</pre>
                  </div>
                </div>
                <p>If there is any configuration error, fix it.</p>
              </div>
              <div class="section" id="check-queue-alerts-ar">
                <h3>
                  <a class="toc-backref" href="#id7">Check queue/alerts/ar</a
                  ><a
                    class="headerlink"
                    href="#check-queue-alerts-ar"
                    title="Permalink to this headline"
                    >¶</a
                  >
                </h3>
                <p>
                  If you have logs similar to the following in
                  <code class="docutils literal notranslate"
                    ><span class="pre"
                      >/var/OpenArmor/queue/alerts/ar</span
                    ></code
                  >:
                </p>
                <div class="highlight-default notranslate">
                  <div class="highlight">
                    <pre><span></span><span class="mi">2009</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="mi">17</span> <span class="mi">12</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">04</span> <span class="n">OpenArmor</span><span class="o">-</span><span class="n">analysisd</span><span class="p">(</span><span class="mi">1210</span><span class="p">):</span> <span class="n">ERROR</span><span class="p">:</span> <span class="n">Queue</span> <span class="s1">&#39;/queue/alerts/ar&#39;</span> <span class="ow">not</span> <span class="n">accessible</span><span class="p">:</span> <span class="s1">&#39;Connection refused&#39;</span><span class="o">.</span>
<span class="mi">2009</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="mi">17</span> <span class="mi">12</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">04</span> <span class="n">OpenArmor</span><span class="o">-</span><span class="n">analysisd</span><span class="p">(</span><span class="mi">1301</span><span class="p">):</span> <span class="n">ERROR</span><span class="p">:</span> <span class="n">Unable</span> <span class="n">to</span> <span class="n">connect</span> <span class="n">to</span> <span class="n">active</span> <span class="n">response</span> <span class="n">queue</span><span class="o">.</span>
</pre>
                  </div>
                </div>
                <p>
                  It means that there is nothing listening on the other end of
                  the socket the
                  <a
                    class="reference internal"
                    href="../programs/OpenArmor-analysisd.html#OpenArmor-analysisd"
                    ><span class="std std-ref">OpenArmor-analysisd</span></a
                  >
                  deamon would want to write to. This can happen in an OpenArmor
                  server installation. The deamon that should be listening on
                  this socket is
                  <a
                    class="reference internal"
                    href="../programs/OpenArmor-remoted.html#OpenArmor-remoted"
                    ><span class="std std-ref">OpenArmor-remoted</span></a
                  >.
                </p>
                <p><strong>How to fix it:</strong></p>
                <p>
                  Add an OpenArmor client (agent) with the
                  <a
                    class="reference internal"
                    href="../programs/manage_agents.html#manage-agents"
                    ><span class="std std-ref">manage_agents</span></a
                  >
                  utility on both agent and server. Then restart OpenArmor.
                  <a
                    class="reference internal"
                    href="../programs/OpenArmor-remoted.html#OpenArmor-remoted"
                    ><span class="std std-ref">OpenArmor-remoted</span></a
                  >
                  should now be listening on the socket.
                </p>
              </div>
            </div>
            <div
              class="section"
              id="remote-commands-are-not-accepted-from-the-manager-ignoring-it-on-the-agent-conf"
            >
              <h2>
                <a class="toc-backref" href="#id8"
                  >Remote commands are not accepted from the manager. Ignoring
                  it on the agent.conf</a
                ><a
                  class="headerlink"
                  href="#remote-commands-are-not-accepted-from-the-manager-ignoring-it-on-the-agent-conf"
                  title="Permalink to this headline"
                  >¶</a
                >
              </h2>
              <p>
                This error message is caused by
                <code class="docutils literal notranslate"
                  ><span class="pre">command</span></code
                >
                or
                <code class="docutils literal notranslate"
                  ><span class="pre">full_command</span></code
                >
                log types in the agent.conf. Originally OpenArmor supported
                running commands from the agent.conf by default. This was later
                changed as a security precaution due to the commands being run
                as root. When a command is encountered on an agent in the
                agent.conf this error will be produced and the agent may not
                fully start. This error may also accompany the above error
                message:
              </p>
              <div class="highlight-console notranslate">
                <div class="highlight">
                  <pre><span></span><span class="go">ERROR: Configuration error at &#39;/var/OpenArmor-agent/etc/shared/agent.conf&#39;. Exiting.</span>
</pre>
                </div>
              </div>
            </div>
            <div class="section" id="errors-when-dealing-with-multiple-agents">
              <h2>
                <a class="toc-backref" href="#id9"
                  >Errors when dealing with multiple agents</a
                ><a
                  class="headerlink"
                  href="#errors-when-dealing-with-multiple-agents"
                  title="Permalink to this headline"
                  >¶</a
                >
              </h2>
              <p>
                When you have hundreds (or even thousands) of agents, OpenArmor
                may not work properly by default. There are a few changes that
                you will need to do:
              </p>
              <p><strong>Increase maximum number of allowed agents</strong></p>
              <p>
                To increase the number of agents, before you install (or update
                OpenArmor), just do:
              </p>
              <div class="highlight-console notranslate">
                <div class="highlight">
                  <pre><span></span><span class="gp">#</span><span class="nb">cd</span> src<span class="p">;</span> make setmaxagents <span class="o">(</span>it will ask how many <span class="k">do</span> you want.. <span class="o">)</span>

<span class="go">Specify maximum number of agents: 2048 (to increase to 2048)</span>
<span class="go">Maximum number of agents set to 20.</span>

<span class="gp">#</span><span class="nb">cd</span> ..<span class="p">;</span> ./install.sh
</pre>
                </div>
              </div>
              <p><strong>Increase your system’s limits</strong></p>
              <p>
                Most systems have limits regarding the maximum number of files
                you can have. A few commands you should try are (to increase to
                2048):
              </p>
              <div class="highlight-console notranslate">
                <div class="highlight">
                  <pre><span></span><span class="gp"># </span><span class="nb">ulimit</span> -n <span class="m">2048</span>
<span class="gp"># </span>sysctl -w kern.maxfiles<span class="o">=</span><span class="m">2048</span>
</pre>
                </div>
              </div>
            </div>
            <div class="section" id="fixing-duplicate-errors">
              <h2>
                <a class="toc-backref" href="#id10">Fixing Duplicate Errors</a
                ><a
                  class="headerlink"
                  href="#fixing-duplicate-errors"
                  title="Permalink to this headline"
                  >¶</a
                >
              </h2>
              <p>
                OpenArmor agents and server keep a counter of each message sent
                and received in files in …/OpenArmor/queue/rids. This is a
                technique to prevent replay attacks. If the counters between
                agent and server don’t match you’ll see errors like this in the
                agents OpenArmor.log file:
              </p>
              <div class="highlight-console notranslate">
                <div class="highlight">
                  <pre><span></span><span class="go">2007/10/24 11:19:21 OpenArmor-agentd: Duplicate error:  global: 12, local: 3456, saved global: 78, saved local: 91011</span>
<span class="go">2007/10/24 11:19:21 OpenArmor-agentd(&lt;pid&gt;): Duplicated counter for &#39;&lt;host name&gt;&#39;.</span>
<span class="go">2007/10/24 11:19:21 OpenArmor-agentd(&lt;pid&gt;): Problem receiving message from www.xxx.yyy.zzz.</span>
</pre>
                </div>
              </div>
              <p>
                This normally happens when you restore the OpenArmor files from
                a backup or you reinstall server or agents without performing an
                upgrade, this can also be caused by duplicate agent ID’s. The
                fix for this problem is:
              </p>
              <ol class="arabic simple">
                <li><p>On every agent:</p></li>
              </ol>
              <blockquote>
                <div>
                  <ol class="arabic simple">
                    <li><p>stop OpenArmor</p></li>
                    <li>
                      <p>
                        go to: …/OpenArmor/queue/rids (or OpenArmor-agent/rids
                        on Windows) and remove every file in there.
                      </p>
                    </li>
                  </ol>
                </div>
              </blockquote>
              <ol class="arabic simple" start="2">
                <li><p>Go to the server:</p></li>
              </ol>
              <blockquote>
                <div>
                  <ol class="arabic simple">
                    <li><p>Stop OpenArmor</p></li>
                    <li>
                      <p>
                        Remove the rids file with the same name as the agent id
                        that is reporting errors.
                      </p>
                    </li>
                  </ol>
                </div>
              </blockquote>
              <ol class="arabic simple" start="3">
                <li><p>Restart the server</p></li>
                <li><p>Restart the agents.</p></li>
              </ol>
              <dl class="simple">
                <dt>
                  To avoid this problem from ever happening again, make sure to:
                </dt>
                <dd>
                  <ul class="simple">
                    <li>
                      <p>
                        Always use the update option (when updating). Do not
                        remove and reinstall the OpenArmor server, unless you
                        plan to do the same for all agents.
                      </p>
                    </li>
                    <li>
                      <p>
                        Do not re-use the same agent key between multiple agents
                        or the same agent key after you remove/re-install an
                        agent. If you use the “update” options everything should
                        just work.
                      </p>
                    </li>
                  </ul>
                </dd>
              </dl>
            </div>
            <div
              class="section"
              id="agent-won-t-connect-to-the-manager-or-the-agent-always-shows-never-connected"
            >
              <h2>
                <a class="toc-backref" href="#id11"
                  >Agent won’t connect to the manager or the agent always shows
                  never connected</a
                ><a
                  class="headerlink"
                  href="#agent-won-t-connect-to-the-manager-or-the-agent-always-shows-never-connected"
                  title="Permalink to this headline"
                  >¶</a
                >
              </h2>
              <p>
                The following log messages may appear in the
                <code class="docutils literal notranslate"
                  ><span class="pre">OpenArmor.log</span></code
                >
                file on an agent when it is having issues connecting to a
                manager:
              </p>
              <div class="highlight-console notranslate">
                <div class="highlight">
                  <pre><span></span><span class="go">2011/11/13 18:05:13 OpenArmor-agent: WARN: Process locked. Waiting for permission...</span>
<span class="go">2011/11/13 18:05:24 OpenArmor-agent(4101): WARN: Waiting for server reply (not started). Tried: &#39;10.10.134.241&#39;.</span>
<span class="go">2011/11/13 18:05:26 OpenArmor-agent: INFO: Trying to connect to server (10.10.134.241:1514).</span>
<span class="go">2011/11/13 18:05:26 OpenArmor-agent: INFO: Using IPv4 for: 10.10.134.241 .</span>
<span class="go">2011/11/13 18:05:47 OpenArmor-agent(4101): WARN: Waiting for server reply (not started). Tried: &#39;10.10.134.241&#39;.</span>
</pre>
                </div>
              </div>
              <p>
                If the agent’s packets are making it to the manager, the manager
                will also include error messages in its
                <code class="docutils literal notranslate"
                  ><span class="pre">OpenArmor.log</span></code
                >
                related to that agent. Some possible issues:
              </p>
              <ul class="simple">
                <li>
                  <p>
                    The agent may not be using the correct IP address. Some
                    systems with multiple IP addresses may not choose the
                    correct one to communicate with the OpenArmor manager. Using
                    <code class="docutils literal notranslate"
                      ><span class="pre">any</span></code
                    >
                    or a CIDR address (192.168.1.0/24) for the agent may be one
                    solution, and adjusting the system’s route settings is
                    another.
                  </p>
                </li>
                <li>
                  <p>
                    Every agent must be using a unique key. If 2 agents look
                    like they’re coming from the same IP (possibly from a NAT
                    gateway), then
                    <code class="docutils literal notranslate"
                      ><span class="pre">any</span></code
                    >
                    or the CIDR address should be used to identify them on the
                    manager.
                  </p>
                </li>
                <li>
                  <p>
                    There may be a firewall blocking the OpenArmor traffic, udp
                    1514 should be allowed to and from the manager.
                  </p>
                </li>
                <li>
                  <p>
                    UAC may be blocking the OpenArmor service from communicating
                    with the manager on Windows 7.
                  </p>
                </li>
              </ul>
            </div>
            <div
              class="section"
              id="i-am-seeing-high-cpu-utilization-on-a-windows-agent"
            >
              <h2>
                <a class="toc-backref" href="#id12"
                  >I am seeing high CPU utilization on a Windows agent</a
                ><a
                  class="headerlink"
                  href="#i-am-seeing-high-cpu-utilization-on-a-windows-agent"
                  title="Permalink to this headline"
                  >¶</a
                >
              </h2>
              <p>
                Some OpenArmor HIDS users who have deployed the Windows agent
                have experienced situations where the windows OpenArmor agent
                causes high CPU utilization. In some cases, this may be due to
                syscheck having to do integrity checking on a large number of
                files and the frequency with which this is done. The high CPU
                utilization could also take place when the OpenArmor agent has
                to analyze Windows Event logs with very large numbers of
                generated events.
              </p>
              <p>A clue to what may be happening are alerts like these:</p>
              <div class="highlight-console notranslate">
                <div class="highlight">
                  <pre><span></span><span class="go">OpenArmor HIDS Notification.</span>
<span class="go">2006 Oct 24 03:18:07</span>

<span class="go">Received From: (ACME-5) 10.23.54.40-&gt;WinEvtLog</span>
<span class="go">Rule: 11 fired (level 8) -&gt; &quot;Excessive number of events (above normal).&quot;</span>
<span class="go">Portion of the log(s):</span>

<span class="go">The average number of logs between 3:00 and 4:00 is 268689. We reached 270690.</span>



<span class="go">--END OF NOTIFICATION</span>
</pre>
                </div>
              </div>
              <p>
                The above alert indicates the condition where a large number of
                events are being generated in the Windows event logs. In
                Windows, setting the Windows audit policy to
                <a
                  class="reference external"
                  href="http://technet2.microsoft.com/WindowsServer/en/library/50fdb7bc-7dae-4dcd-8591-382aeff2ea791033.mspx?mfr=true"
                  >Audit Object Access</a
                >
                or
                <a
                  class="reference external"
                  href="http://technet2.microsoft.com/WindowsServer/en/library/50fdb7bc-7dae-4dcd-8591-382aeff2ea791033.mspx?mfr=true"
                  >Audit Process Tracking</a
                >
                can cause the generation of many event log entries. This gives
                the OpenArmor agent much more work to do in log analysis, and
                thus causes the consumption of much more CPU cycles. To reduce
                the CPU utilization in this case, the solution is to disable
                auditing of object access and/or process tracking. Typically,
                these audit settings aren’t required except for debugging
                purposes, or situations in which you absolutely have to track
                everything.
              </p>
            </div>
            <div
              class="section"
              id="my-etc-hosts-deny-file-is-blank-after-install-2-8-1"
            >
              <h2>
                <a class="toc-backref" href="#id13"
                  >My /etc/hosts.deny file is blank after install 2.8.1!</a
                ><a
                  class="headerlink"
                  href="#my-etc-hosts-deny-file-is-blank-after-install-2-8-1"
                  title="Permalink to this headline"
                  >¶</a
                >
              </h2>
              <p>
                There was a bug introduced to the host-deny.sh script that would
                empty the file. It has been fixed for 2.9. Some variable
                declarations in the script have a space between the variable
                name, the
                <code class="docutils literal notranslate"
                  ><span class="pre">=</span></code
                >, and the value. Removing these spaces allows the script to
                work as planned. If you are using a system that is still using
                tcpwrappers, either use the current
                <a
                  class="reference external"
                  href="https://raw.githubusercontent.com/OpenArmor/OpenArmor-hids/master/active-response/host-deny.sh"
                  >host-deny.sh</a
                >, or remove the spaces from the script before installation.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p class="pull-right">
          <a href="#">Back to top</a>
        </p>
        <p>
          &copy; Copyright 2010-2021, OpenArmor Project Team.<br />
          OpenArmor <b>OpenArmor.net</b> domain owned and maintained by
          <a href="https://theopenarmor.org" target="_blank"
            >OpenArmor Foundation</a
          ><br />
          Home page graphics courtesy of
          <a href="https://pixabay.com" target="_blank">pixabay</a>
        </p>
      </div>
    </footer>
  </body>
</html>
