<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Log samples for Iplog &#8212; OpenArmor</title>
    <link
      rel="stylesheet"
      href="../../../_static/pygments.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../../_static/bootstrap-sphinx.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../../_static/bootstrap-3.2.0/css/bootstrap.min.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../../_static/bootstrap-3.2.0/css/bootstrap-theme.min.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../../_static/bootstrap-sphinx.css"
      type="text/css"
    />
    <link
      rel="stylesheet"
      href="../../../_static/parallax.css"
      type="text/css"
    />
    <script
      id="documentation_options"
      data-url_root="../../../"
      src="../../../_static/documentation_options.js"
    ></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script src="../../../_static/js/jquery-fix.js"></script>
    <script src="../../../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script src="../../../_static/bootstrap-sphinx.js"></script>
    <link
      rel="author"
      title="About these documents"
      href="../../../about.html"
    />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-138780766-1"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-138780766-1");
    </script>

    <script type="text/javascript">
      var _ss = _ss || [];
      _ss.push([
        "_setDomain",
        "https://koi-3QNN51VTHS.marketingautomation.services/net",
      ]);
      _ss.push(["_setAccount", "KOI-4APYNOYP8O"]);
      _ss.push(["_trackPageView"]);
      window._pa = window._pa || {};
      // _pa.orderId = "myOrderId"; // OPTIONAL: attach unique conversion identifier to conversions
      // _pa.revenue = "19.99"; // OPTIONAL: attach dynamic purchase values to conversions
      // _pa.productId = "myProductId"; // OPTIONAL: Include product ID for use with dynamic ads
      (function () {
        var ss = document.createElement("script");
        ss.type = "text/javascript";
        ss.async = true;
        ss.src =
          ("https:" == document.location.protocol ? "https://" : "http://") +
          "koi-3QNN51VTHS.marketingautomation.services/client/ss.js?ver=2.4.0";
        var scr = document.getElementsByTagName("script")[0];
        scr.parentNode.insertBefore(ss, scr);
      })();
    </script>

    <link rel="icon" href="favicon/favicon.ico" type="image/x-icon" />
  </head>
  <body>
    <div id="navbar" class="navbar navbar-inverse navbar-default">
      <div class="container">
        <div class="navbar-header">
          <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
          <button
            type="button"
            class="navbar-toggle"
            data-toggle="collapse"
            data-target=".nav-collapse"
          >
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../../index.html"
            ><img src="../../../_static/OpenArmor_logo_bare_small.jpg" />
            OpenArmor</a
          >
          <span class="navbar-text navbar-version pull-left"><b>3.6.0</b></span>
        </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li><a href="https://theopenarmor.org/about/">About</a></li>
            <li><a href="https://theopenarmor.org/docs/">Documentation</a></li>
            <li>
              <a href="https://theopenarmor.org/register-for-OpenArmor/"
                >Get OpenArmor+</a
              >
            </li>
            <li><a href="https://theopenarmor.org/downloads/">Downloads</a></li>

            <li class="dropdown globaltoc-container">
              <a
                role="button"
                id="dLabelGlobalToc"
                data-toggle="dropdown"
                data-target="#"
                href="../../../index.html"
                >Site <b class="caret"></b
              ></a>
              <ul
                class="dropdown-menu globaltoc"
                role="menu"
                aria-labelledby="dLabelGlobalToc"
              >
                <ul>
                  <li class="toctree-l1">
                    <a class="reference internal" href="../../manual/index.html"
                      >Manual</a
                    >
                  </li>
                </ul>
                <ul>
                  <li class="toctree-l1">
                    <a class="reference internal" href="../../faq/index.html"
                      >Frequently asked questions</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../../cookbooks/index.html"
                      >User submitted Cookbooks</a
                    >
                  </li>
                </ul>
                <ul>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../../development/build/index.html"
                      >Build, compile, and not much more</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../../development/oRFC/index.html"
                      >oRFC:</a
                    >
                  </li>
                </ul>
                <ul>
                  <li class="toctree-l1">
                    <a class="reference internal" href="../../syntax/index.html"
                      >Syntax and Options</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../../formats/index.html"
                      >Output Formats</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../../programs/index.html"
                      >Man pages</a
                    >
                  </li>
                  <li class="toctree-l1">
                    <a
                      class="reference internal"
                      href="../../examples/index.html"
                      >Examples</a
                    >
                  </li>
                </ul>
              </ul>
            </li>
          </ul>

          <form
            class="navbar-form navbar-right"
            action="../../../search.html"
            method="get"
          >
            <div class="form-group">
              <input
                type="text"
                name="q"
                class="form-control"
                placeholder="Search"
              />
            </div>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="section" id="log-samples-for-iplog">
            <h1>
              Log samples for Iplog<a
                class="headerlink"
                href="#log-samples-for-iplog"
                title="Permalink to this headline"
                >Â¶</a
              >
            </h1>
            <div class="admonition warning">
              <p class="admonition-title">Warning</p>
              <p>
                This document is extracted directly from the old wiki. It is
                probably out of date, and definitely not formatted properly.
              </p>
            </div>
            <p>
              Some log samples for
              <a
                class="reference external"
                href="http://freshmeat.net/projects/iplog/"
                >iplog</a
              >
            </p>
            <div class="highlight-console notranslate">
              <div class="highlight">
                <pre><span></span><span class="go">Nov  9 16:24:47 TCP: ftp connection attempt from mail.derkeiler.com (195.140.232.116):52516</span>
<span class="go">Nov  9 16:24:47 TCP: pptp connection attempt from mail.derkeiler.com (195.140.232.116):51624</span>
<span class="go">Nov  9 16:24:47 TCP: domain connection attempt from mail.derkeiler.com (195.140.232.116):56341</span>
<span class="go">Nov  9 16:24:47 TCP: ldaps connection attempt from mail.derkeiler.com (195.140.232.116):57057</span>
<span class="go">Nov  9 16:24:47 TCP: https connection attempt from mail.derkeiler.com (195.140.232.116):2032</span>
<span class="go">Nov  9 16:24:47 TCP: ldap connection attempt from mail.derkeiler.com (195.140.232.116):53716</span>
<span class="go">Nov  9 16:24:47 TCP: rdp connection attempt from mail.derkeiler.com (195.140.232.116):62101</span>
<span class="go">Nov  9 16:24:47 TCP: rtsp connection attempt from mail.derkeiler.com (195.140.232.116):60003</span>
<span class="go">Nov  9 16:24:49 TCP: rtsp connection attempt from mail.derkeiler.com (195.140.232.116):58672</span>
<span class="go">Nov  9 16:24:49 TCP: pptp connection attempt from mail.derkeiler.com (195.140.232.116):56416</span>
<span class="go">Nov  9 16:24:49 TCP: rdp connection attempt from mail.derkeiler.com (195.140.232.116):50295</span>
<span class="go">Nov  9 16:24:49 TCP: https connection attempt from mail.derkeiler.com (195.140.232.116):53896</span>
<span class="go">Nov  9 16:24:49 TCP: ldap connection attempt from mail.derkeiler.com (195.140.232.116):65200</span>
<span class="go">Nov  9 16:24:49 TCP: ftp connection attempt from mail.derkeiler.com (195.140.232.116):61067</span>
<span class="go">Nov  9 16:24:49 TCP: port scan detected [ports 21,1723,53,636,443,389,3389,554] from mail.derkeiler.com (195.140.232.116) [ports 52516,51624$</span>
<span class="go">Nov  9 16:26:39 TCP: port scan mode expired for mail.derkeiler.com (195.140.232.116) - received a total of 3308 packets (132320 bytes).</span>
</pre>
              </div>
            </div>
            <p>
              =iplog= iplog is a TCP/IP traffic logger. Currently, it is capable
              of logging TCP, UDP, and ICMP traffic. iplog is able to detect TCP
              port scans, TCP null scans, FIN scans, UDP and ICMP âsmurfâ
              attacks, bogus TCP flags, TCP SYN scans, TCP âXmasâ scans, ICMP
              ping floods, UDP scans, and IP fragment attacks. iplog is able to
              run in promiscuous mode and monitor traffic to all hosts on a
              network. iplog uses libpcap to read data from the network and can
              be ported to any system that supports pthreads and on which
              libpcap will function.
            </p>
            <p>=iplog.conf=</p>
            <blockquote>
              <div>
                <p>
                  the syslog, user, group and internal network configuration is
                  not show (OS dependient) iplog can log in diferets ways
                  depending of the configuration parameters (DNS resolv,
                  log_dest, etc), the proposed decoders and rules only work with
                  the logs later described, this configuration file extract is
                  functional with this requeriment, please read man iplog and
                  man iplog.conf
                </p>
              </div>
            </blockquote>
            <p>
              &lt;nowiki&gt;# Log the IP address as well as the hostname of
              packets.&lt;/nowiki&gt;
            </p>
            <p>set log_ip true</p>
            <p>
              &lt;nowiki&gt;# Do not log the destination of packets (more
              presentable logs)&lt;/nowiki&gt;
            </p>
            <p>set log_dest false</p>
            <p>
              &lt;nowiki&gt;# Ignore DNS traffic from nameservers in
              /etc/resolv.conf.&lt;/nowiki&gt;
            </p>
            <p>set ignore_dns true</p>
            <p>
              &lt;nowiki&gt;# I dont want too many logs: ignore www, netbios,
              microsoft-ds loc-srv, 5900 tcp/port conecctions, not all the OS
              recognize the port alias, replace with de adecuate port
              number&lt;/nowiki&gt;
            </p>
            <p>ignore tcp dport 80</p>
            <p>ignore tcp dport netbios-ssn</p>
            <p>ignore tcp dport microsoft-ds</p>
            <p>ignore tcp dport loc-srv</p>
            <p>ignore tcp dport 5900</p>
            <p>&lt;nowiki&gt;# Port Scan Check&lt;/nowiki&gt;</p>
            <p>set portscan true</p>
            <p>set icmp true</p>
            <p>set frag true</p>
            <p>set smurf true</p>
            <p>set bogus true</p>
            <p>set fin_scan true</p>
            <p>set syn_scan true</p>
            <p>set udp_scan true</p>
            <p>set fool_nmap false</p>
            <p>set xmas_scan true</p>
            <p>set null_scan true</p>
            <p>set ping_flood true</p>
            <p>set traceroute true</p>
            <p>=iplog: Scan and attack responses=</p>
            <p>
              ==âââConnect Scan and SYN scanâââ== nmap -sT -PI -PT 10.10.160.2
            </p>
            <p>âââiplog responseâââ</p>
            <p>
              Nov 14 18:09:08 TCP: domain connection attempt from
              10.10.150.1:51239
            </p>
            <p>
              Nov 14 18:09:08 TCP: https connection attempt from
              10.10.150.1:51240
            </p>
            <p>
              Nov 14 18:09:08 TCP: port 1723 connection attempt from
              10.10.150.1:51241
            </p>
            <p>
              Nov 14 18:09:08 TCP: ftp connection attempt from 10.10.150.1:51242
            </p>
            <p>
              Nov 14 18:09:08 TCP: smtp connection attempt from
              10.10.150.1:51243
            </p>
            <p>
              Nov 14 18:09:08 TCP: port 3389 connection attempt from
              10.10.150.1:51244
            </p>
            <p>
              Nov 14 18:09:08 TCP: auth connection attempt from
              10.10.150.1:51245
            </p>
            <p>
              Nov 14 18:09:08 TCP: port 636 connection attempt from
              10.10.150.1:51246
            </p>
            <p>
              Nov 14 18:09:08 TCP: port 256 connection attempt from
              10.10.150.1:51247
            </p>
            <p>
              Nov 14 18:09:08 TCP: port 554 connection attempt from
              10.10.150.1:51248
            </p>
            <p>
              Nov 14 18:09:08 TCP: telnet connection attempt from
              10.10.150.1:51249
            </p>
            <p>
              Nov 14 18:09:08 TCP: port 389 connection attempt from
              10.10.150.1:51250
            </p>
            <p>
              Nov 14 18:09:08 TCP: ssh connection attempt from 10.10.150.1:51251
            </p>
            <p>
              Nov 14 18:09:08 TCP: port 486 connection attempt from
              10.10.150.1:51253
            </p>
            <p>
              &lt;font color=âredâ&gt;Nov 14 18:09:08 TCP: port scan detected
              [ports 53,443,1723,21,25,3389,113,636,256,554,â¦] from 10.10.150.1
              [ports 51242,51243,â¦]&lt;/font&gt;
            </p>
            <p>
              Nov 14 18:09:08 UDP: dgram to port 1 from 10.10.150.1:34324 (300
              data bytes)
            </p>
            <p>
              &lt;font color=âredâ&gt;Nov 14 18:09:12 TCP: SYN scan detected
              [ports 21,1] from 10.10.150.1 [ports
              34333,34335,34325,34326,34327,â¦]&lt;/font&gt;
            </p>
            <p>
              Nov 14 18:09:12 UDP: dgram to port 1 from 10.10.150.1:34324 (300
              data bytes)
            </p>
            <p>Nov 14 18:10:02 last message repeated 1 times</p>
            <p>
              Nov 14 18:10:02 TCP: port scan mode expired for 10.10.150.1 -
              received a total of 1678 packets (47092 bytes).
            </p>
            <p>
              Nov 14 18:10:09 TCP: SYN scan mode expired for 10.10.150.1 -
              received a total of 24 packets (960 bytes).
            </p>
            <p>==âââFIN Stealth Scanâââ== nmap -sF -p- -PI -PT 10.10.150.2</p>
            <p>âââiplog responseâââ</p>
            <p>
              &lt;font color=âredâ&gt;Nov 14 18:22:51 TCP: FIN scan detected
              [ports 3389,1723,256,113,22,389,554,443,21,23,â¦] from 10.10.150.1
              [port 57876]&lt;/font&gt;
            </p>
            <p>
              Nov 14 18:24:05 TCP: FIN scan mode expired for 10.10.150.1 -
              received a total of 65535 packets (1310700 bytes)
            </p>
            <p>==âââNULL Stealth Scanâââ== nmap -sN -p- -PI -PT 10.10.150.2</p>
            <p>âââiplog responseâââ</p>
            <p>
              &lt;font color=âredâ&gt;Nov 14 18:26:58 TCP: null scan detected
              [ports 636,53,23,3389,1723,443,113,554,25,21,â¦] from 10.10.150.1
              [port 35444]&lt;/font&gt;
            </p>
            <p>
              Nov 14 18:28:14 TCP: null scan mode expired for 10.10.150.1 -
              received a total of 65534 packets (1310680 bytes)
            </p>
            <p>
              ==âââXmas Tree Stealth Scanâââ== nmap -sX -p- -PI -PT 10.10.150.2
            </p>
            <p>âââiplog responseâââ</p>
            <p>
              &lt;font color=âredâ&gt;Nov 14 18:30:30 TCP: Xmas scan detected
              [ports 636,256,554,389,1723,53,443,21,3389,22,â¦] from 10.10.150.1
              [port 42399]&lt;/font&gt;
            </p>
            <p>
              Nov 14 18:31:48 TCP: Xmas scan mode expired for 10.10.150.1 -
              received a total of 65532 packets (1310640 bytes).
            </p>
            <p>==âââUDP port scanâââ== nmap -sU -p- -PI -PT 10.10.150.2</p>
            <p>âââiplog responseâââ</p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 33161 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 41107 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 63571 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 48714 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 25271 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 13612 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 41094 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 52700 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 11482 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 62794 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 28270 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 27081 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 10866 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 63494 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 28686 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 44600 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 21771 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 53283 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 44436 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 46916 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 30519 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:34:59 UDP: dgram to port 8041 from 10.10.150.1:60362 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:35:00 UDP: dgram to port 8041 from 10.10.150.1:60363 (0
              data bytes)
            </p>
            <p>
              Nov 14 18:35:00 UDP: dgram to port 30519 from 10.10.150.1:60363 (0
              data bytes)
            </p>
            <p>
              &lt;font color=âredâ&gt;Nov 14 18:35:00 UDP: scan/flood detected
              [ports 33161,41107,63571,48714,25271,â¦] from 10.10.150.1 [ports
              60362]&lt;/font&gt;
            </p>
            <p>
              Nov 14 18:39:15 UDP: scan/flood mode expired for 10.10.150.1 -
              received a total of 356 packets (2848 bytes).
            </p>
            <p>==âââtracerouteâââ== traceroute 10.10.150.1</p>
            <p>âââiplog responseâââ</p>
            <p>
              &lt;font color=âredâ&gt;Nov 14 18:57:18 UDP: traceroute from
              10.10.150.2&lt;/font&gt;
            </p>
            <p>==âââFlood ping attackâââ== ping -f 10.10.150.2</p>
            <p>âââiplog responseâââ</p>
            <p>
              &lt;font color=âredâ&gt;Nov 14 19:09:33 ICMP: ping flood detected
              from 10.10.150.1&lt;/font&gt;
            </p>
            <p>
              Nov 14 19:11:29 ICMP: ping flood mode expired for 10.10.150.1 -
              received a total of 428 packets (8416000 bytes).
            </p>
            <p>==âââIP fragment attacksâââ== TODO</p>
            <p>
              ==âââUDP and ICMP âsmurfâ attacksâââ== Nov 18 19:12:30 ICMP/UDP:
              smurf attack detected from 201.223.41.0
            </p>
            <p>
              &lt;font color=âredâ&gt;Nov 18 19:23:30 ICMP/UDP: smurf attack
              detected from 201.223.41.0&lt;/font&gt;
            </p>
            <p>
              Nov 18 19:28:07 ICMP/UDP: smurf attack mode expired for
              201.223.41.0 - received a total of 337 packets (21568 bytes).
            </p>
            <p>==âââAnother interesting logsâââ==</p>
            <p>âââbogus TCP flagsâââ</p>
            <p>
              &lt;font color=âredâ&gt;Nov 14 15:57:56 TCP: Bogus TCP flags set
              by 10.10.160.2:60873 (dest port 25)&lt;/font&gt;
            </p>
            <p>=âââOpenArmor (HIDS) + iplog (sensor) implementationâââ=</p>
            <p>
              <a href="#id1"><span class="problematic" id="id2">*</span></a
              >Work in progress
              <a href="#id3"><span class="problematic" id="id4">*</span></a
              >TODO: improve regex, decoders and rules. p0f complementation?
              <a href="#id5"><span class="problematic" id="id6">*</span></a
              >Configuration tested in FreeBSD 6.1 and archlinux gimmick
              <a href="#id7"><span class="problematic" id="id8">*</span></a
              >Last modification 14/Nov/2006
            </p>
            <p>==âââiplog decoderâââ==</p>
            <p>âââFor this logs:âââ</p>
            <p>
              Nov 14 18:09:12 TCP: SYN scan detected [ports 21,1] from
              10.10.150.1 [ports 34333,34335,34325,34326,34327,â¦]
            </p>
            <p>
              Nov 14 18:09:08 TCP: port scan detected [ports
              53,443,1723,21,25,3389,113,636,256,554,â¦] from 10.10.150.1 [ports
              51242,51243,â¦]
            </p>
            <p>
              Nov 14 18:22:51 TCP: FIN scan detected [ports
              3389,1723,256,113,22,389,554,443,21,23,â¦] from 10.10.150.1 [port
              57876]
            </p>
            <p>
              Nov 14 18:26:58 TCP: null scan detected [ports
              636,53,23,3389,1723,443,113,554,25,21,â¦] from 10.10.150.1 [port
              35444]
            </p>
            <p>
              Nov 14 18:30:30 TCP: Xmas scan detected [ports
              636,256,554,389,1723,53,443,21,3389,22,â¦] from 10.10.150.1 [port
              42399]
            </p>
            <p>âââa working decoder is:âââ</p>
            <div class="highlight-xml notranslate">
              <div class="highlight">
                <pre><span></span><span class="nt">&lt;decoder</span> <span class="na">name=</span><span class="s">&quot;iplog-scan&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;prematch&gt;</span>\S+ scan detected<span class="nt">&lt;/prematch&gt;</span>
 <span class="nt">&lt;regex</span> <span class="na">offset=</span><span class="s">&quot;after_prematch&quot;</span><span class="nt">&gt;</span>\S+ \S+ from (\S+)<span class="nt">&lt;/regex&gt;</span>
 <span class="nt">&lt;order&gt;</span>srcip<span class="nt">&lt;/order&gt;</span>
<span class="nt">&lt;/decoder&gt;</span>
</pre>
              </div>
            </div>
            <p>âââFor this log:âââ</p>
            <p>
              Nov 14 18:35:00 UDP: scan/flood detected [ports
              33161,41107,63571,48714,25271,â¦] from 10.10.150.1 [ports 60362]
            </p>
            <p>âââa proppossed decoder is (not tested):âââ</p>
            <div class="highlight-xml notranslate">
              <div class="highlight">
                <pre><span></span><span class="nt">&lt;decoder</span> <span class="na">name=</span><span class="s">&quot;iplog-flood&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;prematch&gt;</span>scan/flood detected<span class="nt">&lt;/prematch&gt;</span>
  <span class="nt">&lt;regex</span> <span class="na">offset=</span><span class="s">&quot;after_prematch&quot;</span><span class="nt">&gt;</span>\S+ \S+ from (\S+)<span class="nt">&lt;/regex&gt;</span>
  <span class="nt">&lt;order&gt;</span>srcip<span class="nt">&lt;/order&gt;</span>
<span class="nt">&lt;/decoder&gt;</span>
</pre>
              </div>
            </div>
            <p>âââFor this log:âââ</p>
            <p>Nov 14 19:09:33 ICMP: ping flood detected from 10.10.150.1</p>
            <p>âââa proppossed decoder is (not tested):âââ</p>
            <div class="highlight-xml notranslate">
              <div class="highlight">
                <pre><span></span><span class="nt">&lt;decoder</span> <span class="na">name=</span><span class="s">&quot;iplog-pingflood&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;prematch&gt;</span>ping flood detected from<span class="nt">&lt;/prematch&gt;</span>
  <span class="nt">&lt;regex</span> <span class="na">offset=</span><span class="s">&quot;after_prematch&quot;</span><span class="nt">&gt;</span>(\S+)<span class="nt">&lt;/regex&gt;</span>
  <span class="nt">&lt;order&gt;</span>srcip<span class="nt">&lt;/order&gt;</span>
<span class="nt">&lt;/decoder&gt;</span>
</pre>
              </div>
            </div>
            <p>
              âââFor this log:âââ (necesary to include???????) i Think no (very
              paranoic)
            </p>
            <p>Nov 14 18:57:18 UDP: traceroute from 10.10.150.2</p>
            <p>âââa proppossed decoder is (not tested):âââ</p>
            <div class="highlight-xml notranslate">
              <div class="highlight">
                <pre><span></span><span class="nt">&lt;decoder</span> <span class="na">name=</span><span class="s">&quot;iplog-traceroute&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;prematch&gt;</span>pingtraceroute from<span class="nt">&lt;/prematch&gt;</span>
  <span class="nt">&lt;regex</span> <span class="na">offset=</span><span class="s">&quot;after_prematch&quot;</span><span class="nt">&gt;</span>(\S+)<span class="nt">&lt;/regex&gt;</span>
  <span class="nt">&lt;order&gt;</span>srcip<span class="nt">&lt;/order&gt;</span>
<span class="nt">&lt;/decoder&gt;</span>
</pre>
              </div>
            </div>
            <p>
              âââFor this log:âââ (necesary to include???????) i Think no (very
              paranoic)
            </p>
            <p>
              Nov 14 15:57:56 TCP: Bogus TCP flags set by 10.10.160.2:60873
              (dest port 25)
            </p>
            <p>âââa proppossed decoder is (not tested):âââ</p>
            <div class="highlight-xml notranslate">
              <div class="highlight">
                <pre><span></span><span class="nt">&lt;decoder</span> <span class="na">name=</span><span class="s">&quot;iplog-bogustcp&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;prematch&gt;</span>Bogus TCP flags set by<span class="nt">&lt;/prematch&gt;</span>
  <span class="nt">&lt;regex</span> <span class="na">offset=</span><span class="s">&quot;after_prematch&quot;</span><span class="nt">&gt;</span>(\S+):\d+<span class="nt">&lt;/regex&gt;</span>
  <span class="nt">&lt;order&gt;</span>srcip<span class="nt">&lt;/order&gt;</span>
<span class="nt">&lt;/decoder&gt;</span>
</pre>
              </div>
            </div>
            <p>==âââiplog rulesâââ==</p>
            <p>Only for working decoders</p>
            <div class="highlight-console notranslate">
              <div class="highlight">
                <pre><span></span><span class="go">cd ~/OpenArmor/rules</span>
<span class="go">touch iplog_rules.xml</span>
<span class="go">chown root:OpenArmor iplog_rules.xml</span>
<span class="go">chmod 550 iplog_rules.xml</span>
</pre>
              </div>
            </div>
            <p>in iplog_rules.xml include:</p>
            <div class="highlight-xml notranslate">
              <div class="highlight">
                <pre><span></span>  <span class="nt">&lt;group</span> <span class="na">name=</span><span class="s">&quot;syslog,errors,&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;rule</span> <span class="na">id=</span><span class="s">&quot;99990&quot;</span> <span class="na">level=</span><span class="s">&quot;6&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;decoded_as&gt;</span>iplog-scan<span class="nt">&lt;/decoded_as&gt;</span>
    <span class="nt">&lt;description&gt;</span>iplog scan detect<span class="nt">&lt;/description&gt;</span>
  <span class="nt">&lt;/rule&gt;</span>
<span class="nt">&lt;/group&gt;</span>
</pre>
              </div>
            </div>
            <p>==âââOpenArmor.confâââ==</p>
            <div class="highlight-console notranslate">
              <div class="highlight">
                <pre><span></span><span class="go">cd ~/OpenArmor/etc</span>
<span class="go">vi  OpenArmor.conf</span>
</pre>
              </div>
            </div>
            <p>include in the correct place:</p>
            <div class="highlight-xml notranslate">
              <div class="highlight">
                <pre><span></span><span class="nt">&lt;include&gt;</span>iplog_rules.xml<span class="nt">&lt;/include&gt;</span>
</pre>
              </div>
            </div>
            <p>and</p>
            <div class="highlight-xml notranslate">
              <div class="highlight">
                <pre><span></span><span class="nt">&lt;localfile&gt;</span>
  <span class="nt">&lt;log_format&gt;</span>syslog<span class="nt">&lt;/log_format&gt;</span>
  <span class="nt">&lt;location&gt;</span>/var/log/iplog<span class="nt">&lt;/location&gt;</span>
<span class="nt">&lt;/localfile&gt;</span>
</pre>
              </div>
            </div>
            <p>or wherever you put your iplog logs</p>
            <p>start iplog</p>
            <div class="highlight-console notranslate">
              <div class="highlight">
                <pre><span></span><span class="go">iplog -d</span>
</pre>
              </div>
            </div>
            <p>restart OpenArmor</p>
            <div class="highlight-console notranslate">
              <div class="highlight">
                <pre><span></span><span class="go">~/OpenArmor/bin/OpenArmor-control restart</span>
</pre>
              </div>
            </div>
            <p>test with nmap (see before)</p>
            <p>=âââOpenArmor active-responseâââ=</p>
            <p>
              ==âââFirewall Drop: FreeBSD-IPFWâââ== add to your ipfw script the
              follow lines, if you are using the 00001 rule number disoccupying:
            </p>
            <div class="highlight-console notranslate">
              <div class="highlight">
                <pre><span></span><span class="go">/sbin/ipfw add 00001 deny ip from table\(00002\) to any</span>
<span class="go">/sbin/ipfw add 00001 deny ip from any to table\(00002\)</span>
</pre>
              </div>
            </div>
            <p>
              Change ~/OpenArmor/active-response/bin/firewall-drop.sh to adjust
              to the red lines
            </p>
            <div class="highlight-console notranslate">
              <div class="highlight">
                <pre><span></span><span class="go">&lt;nowiki&gt;#!/bin/sh&lt;/nowiki&gt;</span>
<span class="go">&lt;nowiki&gt;# Adds an IP to the IPFW drop list.&lt;/nowiki&gt;</span>
<span class="go">&lt;nowiki&gt;# Only works with IPFW.&lt;/nowiki&gt;</span>
<span class="go">&lt;nowiki&gt;# We use TABLE 00001. If you use this table for anything else,&lt;/nowiki&gt;</span>
<span class="go">&lt;nowiki&gt;# please change it here.&lt;/nowiki&gt;</span>
<span class="go">&lt;nowiki&gt;# Expect: srcip&lt;/nowiki&gt;</span>
<span class="go">&lt;nowiki&gt;# Author: Rafael Capovilla - under @ ( at ) underlinux.com.br&lt;/nowiki&gt;</span>
<span class="go">&lt;nowiki&gt;# Author: Daniel B. Cid - dcid @ ( at ) OpenArmor.net&lt;/nowiki&gt;</span>
<span class="go">&lt;nowiki&gt;# Last modified: May 07, 2006&lt;/nowiki&gt;</span>
<span class="go">UNAME=`uname`</span>
<span class="go">IPFW=&quot;/sbin/ipfw&quot;</span>
<span class="go">ARG1=&quot;&quot;</span>
<span class="go">ARG2=&quot;&quot;</span>
<span class="go">ACTION=$1</span>
<span class="go">USER=$2</span>
<span class="go">IP=$3</span>
<span class="go">&lt;font color=&quot;red&quot;&gt;TABLE_ID=00002&lt;/font&gt;</span>
<span class="go">LOCAL=`dirname $0`;</span>
<span class="go">cd $LOCAL</span>
<span class="go">cd ../</span>
<span class="go">PWD=`pwd`</span>
<span class="go">echo &quot;`date` $0 $1 $2 $3&quot; &gt;&gt; ${PWD}/OpenArmor-hids-responses.log</span>
<span class="go">&lt;nowiki&gt;# Checking for an IP&lt;/nowiki&gt;</span>
<span class="go">if [ &quot;x${IP}&quot; = &quot;x&quot; ]; then</span>
<span class="go">  echo &quot;$0: &lt;action&gt; &lt;username&gt; &lt;ip&gt;&quot;</span>
<span class="go">  exit 1;</span>
<span class="go">fi</span>
<span class="go">&lt;nowiki&gt;# Blocking IP&lt;/nowiki&gt;</span>
<span class="go">if [ &quot;x${ACTION}&quot; != &quot;xadd&quot; -a &quot;x${ACTION}&quot; != &quot;xdelete&quot; ]; then</span>
<span class="go">  echo &quot;$0: Invalid action: ${ACTION}&quot;</span>
<span class="go">  exit 1;</span>
<span class="go">fi</span>
<span class="go">&lt;nowiki&gt;# We should run on FreeBSD&lt;/nowiki&gt;</span>
<span class="go">&lt;nowiki&gt;# We always use table 00001 and rule id 00001.&lt;/nowiki&gt;</span>
<span class="go">if [ &quot;X${UNAME}&quot; = &quot;XFreeBSD&quot; ]; then</span>
<span class="go">  ls ${IPFW} &gt;&gt; /dev/null 2&gt;&amp;1</span>
<span class="go">  if [ $? != 0 ]; then</span>
<span class="go">     exit 0;</span>
<span class="go">  fi</span>
<span class="go">  &lt;nowiki&gt; # Check if our table is set&lt;/nowiki&gt;</span>
<span class="go">  &lt;font color=&quot;red&quot;&gt; ${IPFW} show | grep &quot;^00001&quot; | grep &quot;table(2)&quot; &gt;/dev/null 2&gt;&amp;1&lt;/font&gt;</span>
<span class="go">  if [ ! $? = 0 ]; then</span>
<span class="gp">      # </span>We need to add the table
<span class="gp">      $</span><span class="o">{</span>IPFW<span class="o">}</span> -q <span class="m">00001</span> add deny ip from table<span class="se">\(</span><span class="si">${</span><span class="nv">TABLE_ID</span><span class="si">}</span><span class="se">\)</span> to any
<span class="gp">      $</span><span class="o">{</span>IPFW<span class="o">}</span> -q <span class="m">00001</span> add deny ip from any to table<span class="se">\(</span><span class="si">${</span><span class="nv">TABLE_ID</span><span class="si">}</span><span class="se">\)</span>
<span class="go">  fi</span>
<span class="go">&lt;nowiki&gt;   # Executing and exiting&lt;/nowiki&gt;</span>
<span class="gp">  $</span><span class="o">{</span>IPFW<span class="o">}</span> -q table <span class="si">${</span><span class="nv">TABLE_ID</span><span class="si">}</span> <span class="si">${</span><span class="nv">ACTION</span><span class="si">}</span> <span class="si">${</span><span class="nv">IP</span><span class="si">}</span>
<span class="go">  exit 0;</span>
<span class="go">fi</span>
<span class="go">&lt;nowiki&gt;# Not FreeBSD&lt;/nowiki&gt;</span>
<span class="go">exit 1;</span>
</pre>
              </div>
            </div>
            <p>Include in ~/OpenArmor/etc/OpenArmor.conf:</p>
            <div class="highlight-console notranslate">
              <div class="highlight">
                <pre><span></span><span class="go">&lt;command&gt;</span>
<span class="go">  &lt;name&gt;firewall-drop&lt;/name&gt;</span>
<span class="go">  &lt;executable&gt;firewall-drop.sh&lt;/executable&gt;</span>
<span class="go">  &lt;expect&gt;srcip&lt;/expect&gt;</span>
<span class="go">&lt;/command&gt;</span>

<span class="go">&lt;active-response&gt;</span>
<span class="go">  &lt;disabled&gt;no&lt;/disabled&gt;</span>
<span class="go">  &lt;command&gt;firewall-drop&lt;/command&gt;</span>
<span class="go">  &lt;location&gt;local&lt;/location&gt;</span>
<span class="go">     &lt;rules_id&gt;99990&lt;/rules_id&gt;</span>
<span class="go">&lt;/active-response&gt;</span>
</pre>
              </div>
            </div>
            <dl class="simple">
              <dt>restart OpenArmor:</dt>
              <dd>
                <p><cite>~/OpenArmor/bin/OpenArmor-control restart</cite></p>
              </dd>
              <dt>
                Scan your machine (caution OpenArmor will block the scanner IP)
                from online scanner server like:
                <a
                  class="reference external"
                  href="http://www.derkeiler.com/Service/PortScan/"
                  >http://www.derkeiler.com/Service/PortScan/</a
                >, or from a remote machine with:
              </dt>
              <dd><p>nmap -sT -PI -PT 1.2.3.4</p></dd>
              <dt>look if the active-response works with:</dt>
              <dd><p>/sbin/ipfw table 2 list</p></dd>
              <dt>or</dt>
              <dd>
                <p>
                  tail -f
                  ~/OpenArmor/active-response/OpenArmor-hids-responses.log
                </p>
              </dd>
              <dt>if you want to flush the banned IPs in the table</dt>
              <dd><p>/sbin/ipfw table 2 flush</p></dd>
              <dt>or want to remove a specific IP in the table</dt>
              <dd><p>/sbin/ipfw table 2 delete 1.2.3.4</p></dd>
            </dl>
            <p>if you want to flush the table every 24 Hrs:</p>
            <blockquote>
              <div><p>vi /etc/crontab</p></div>
            </blockquote>
            <dl class="simple">
              <dt>and include</dt>
              <dd>
                <p>
                  0
                  <a href="#id9"><span class="problematic" id="id10">*</span></a
                  >/24 * * * root /sbin/ipfw table 2 flush &gt; /dev/null
                  2&gt;&amp;1
                </p>
              </dd>
            </dl>
            <p>=More restrictions=</p>
            <p>
              <a href="#id11"><span class="problematic" id="id12">*</span></a
              >âââiplog.confâââ To Enable or disable a mechanism that attempts
              to fool programs, such as nmap and queso, that perform remote OS
              detection, add the follow line to iplog.conf
            </p>
            <blockquote>
              <div><p>set fool_nmap true</p></div>
            </blockquote>
            <p>
              As a side effect, enabling this option will also cause most of
              nmapâsstealthâ scans to fail.
            </p>
            <p>
              <a href="#id13"><span class="problematic" id="id14">*</span></a
              >âââBSDâs sysctl (some FreeBSD especific)âââ
            </p>
            <blockquote>
              <div>
                <p>
                  tcp_drop_synfin net.inet.tcp.blackhole net.inet.udp.blackhole
                </p>
              </div>
            </blockquote>
            <p>
              More to com.. [<a
                class="reference external"
                href="http://zaterio.chilesincables.org"
                >http://zaterio.chilesincables.org</a
              >
              Zaterio]
            </p>
            <p>[[Category:rules]] [[Category:decoders]]</p>
          </div>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p class="pull-right">
          <a href="#">Back to top</a>
        </p>
        <p>
          &copy; Copyright 2010-2021, OpenArmor Project Team.<br />
          OpenArmor <b>OpenArmor.net</b> domain owned and maintained by
          <a href="https://theopenarmor.org" target="_blank"
            >OpenArmor Foundation</a
          ><br />
          Home page graphics courtesy of
          <a href="https://pixabay.com" target="_blank">pixabay</a>
        </p>
      </div>
    </footer>
  </body>
</html>
