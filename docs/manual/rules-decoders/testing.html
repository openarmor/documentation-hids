<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Testing OpenArmor rules/decoders &#8212; OpenArmor</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-3.2.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-3.2.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/parallax.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/jquery-1.11.0.min.js"></script>
    <script src="../../../_static/js/jquery-fix.js"></script>
    <script src="../../../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script src="../../../_static/bootstrap-sphinx.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="CDB List lookups from within Rules" href="rule-lists.html" />
    <link rel="prev" title="Rules and Decoders" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138780766-1"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-138780766-1');
</script>

<script type="text/javascript">
  var _ss = _ss || [];
  _ss.push(['_setDomain', 'https://koi-3QNN51VTHS.marketingautomation.services/net']);
  _ss.push(['_setAccount', 'KOI-4APYNOYP8O']);
  _ss.push(['_trackPageView']);
  window._pa = window._pa || {};
  // _pa.orderId = "myOrderId"; // OPTIONAL: attach unique conversion identifier to conversions
  // _pa.revenue = "19.99"; // OPTIONAL: attach dynamic purchase values to conversions
  // _pa.productId = "myProductId"; // OPTIONAL: Include product ID for use with dynamic ads
  (function() {
  var ss = document.createElement('script');
  ss.type = 'text/javascript'; ss.async = true;
  ss.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'koi-3QNN51VTHS.marketingautomation.services/client/ss.js?ver=2.4.0';
  var scr = document.getElementsByTagName('script')[0];
  scr.parentNode.insertBefore(ss, scr);
  })();
  </script>



  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html"><img src="../../../_static/OpenArmor_logo_bare_small.jpg">
          OpenArmor</a>
        <span class="navbar-text navbar-version pull-left"><b>3.6.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://theopenarmor.org/about/">About</a></li>
                <li><a href="https://theopenarmor.org/docs/">Documentation</a></li>
                <li><a href="https://theopenarmor.org/register-for-OpenArmor/">Get OpenArmor+</a></li>
                <li><a href="https://theopenarmor.org/downloads/">Downloads</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Manual</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cookbooks/index.html">User submitted Cookbooks</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/build/index.html">Build, compile, and not much more</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/oRFC/index.html">oRFC:</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../syntax/index.html">Syntax and Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../formats/index.html">Output Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../programs/index.html">Man pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="index.html" title="Previous Chapter: Rules and Decoders"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Rules and Decoders</span>
    </a>
  </li>
  <li>
    <a href="rule-lists.html" title="Next Chapter: CDB List lookups from within Rules"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">CDB List look... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="testing-OpenArmor-rules-decoders">
<h1>Testing OpenArmor rules/decoders<a class="headerlink" href="#testing-OpenArmor-rules-decoders" title="Permalink to this headline">¶</a></h1>
<p>The first problem most people have when troubleshooting OpenArmor or trying to write new
rules and decoders is how to test them. In the past, this would require
manually restarting OpenArmor or creating a testing installation. As of
version 1.6, there is a tool to simplify this task (OpenArmor-logtest).</p>
<div class="section" id="testing-using-OpenArmor-logtest">
<h2>Testing using OpenArmor-logtest<a class="headerlink" href="#testing-using-OpenArmor-logtest" title="Permalink to this headline">¶</a></h2>
<p>The tool <cite>OpenArmor-logtest</cite> is installed into <code class="docutils literal notranslate"><span class="pre">/var/OpenArmor/bin</span></code>.
It will read the current rules and decoder (from <code class="docutils literal notranslate"><span class="pre">/var/OpenArmor</span></code> ) and accept
log input from stdin:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>/var/OpenArmor/bin/OpenArmor-logtest
<span class="go">2008/07/04 09:57:28 OpenArmor-testrule: INFO: Started (pid: 12683).</span>
<span class="go">OpenArmor-testrule: Type one log per line.</span>

<span class="go">Jul 4 09:42:16 enigma sshd[11990]: Accepted password for dcid from 192.168.2.10 port 35259 ssh2</span>

<span class="go">**Phase 1: Completed pre-decoding.</span>
<span class="go">full event: &quot;Jul 4 09:42:16 enigma sshd[11990]: Accepted password for dcid from 192.168.2.10 port 35259 ssh2&quot;</span>
<span class="go">hostname: &quot;enigma&quot;</span>
<span class="go">program_name: &quot;sshd&quot;</span>
<span class="go">log: &quot;accepted password for dcid from 192.168.2.10 port 35259 ssh2&quot;</span>

<span class="go">**Phase 2: Completed decoding.</span>
<span class="go">decoder: ’sshd’</span>
<span class="go">dstuser: ‘dcid’</span>
<span class="go">srcip: ‘192.168.2.10′</span>

<span class="go">**Phase 3: Completed filtering (rules).</span>
<span class="go">Rule id: ‘10100′</span>
<span class="go">Level: ‘4′</span>
<span class="go">Description: ‘First time user logged in.’</span>
<span class="go">**Alert to be generated.</span>
</pre></div>
</div>
<p>In the above example, we provided an authentication success log and
OpenArmor-logtest showed us how it would be decoded, what information was extracted
and which rule fired. In the next example, we can see how it would extract a
user logoff message from Windows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>/var/OpenArmor/bin/OpenArmor-logtest
<span class="go">2008/07/04 09:57:28 OpenArmor-testrule: INFO: Started (pid: 12683).</span>
<span class="go">OpenArmor-testrule: Type one log per line.</span>

<span class="go">WinEvtLog: Security: AUDIT_SUCCESS(538): Security: lac: OpenArmor-HM: OpenArmor-HM: User Logoff: User Name: lac Domain: OpenArmor-HM Logon ID: (0×0,0xF784D5) Logon Type: 2</span>

<span class="go">**Phase 1: Completed pre-decoding.</span>
<span class="go">full event: ‘WinEvtLog: Security: AUDIT_SUCCESS(538): Security: lac: OpenArmor-HM: OpenArmor-HM: User Logoff: User Name: lac Domain: OpenArmor-HM Logon ID: (0×0,0xF784D5) Logon Type: 2′</span>
<span class="go">hostname: ‘enigma’</span>
<span class="go">program_name: ‘(null)’</span>
<span class="go">log: ‘WinEvtLog: Security: AUDIT_SUCCESS(538): Security: lac: OpenArmor-HM: OpenArmor-HM: User Logoff: User Name: lac Domain: OpenArmor-HM Logon ID: (0×0,0xF784D5) Logon Type: 2′</span>

<span class="go">**Phase 2: Completed decoding.</span>
<span class="go">decoder: ‘windows’</span>
<span class="go">status: ‘AUDIT_SUCCESS’</span>
<span class="go">id: ‘538′</span>
<span class="go">extra_data: ‘Security’</span>
<span class="go">dstuser: ‘lac’</span>
<span class="go">system_name: ‘OpenArmor-HM’</span>

<span class="go">**Phase 3: Completed filtering (rules).</span>
<span class="go">Rule id: ‘18149′</span>
<span class="go">Level: ‘3′</span>
<span class="go">Description: ‘Windows User Logoff.’</span>
<span class="go">**Alert to be generated.</span>
</pre></div>
</div>
<p>In addition to the information above, <cite>OpenArmor-logtest -v</cite> can be used
to follow the log through the rule path:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>/var/OpenArmor/bin/OpenArmor-logtest -v
<span class="go">2008/07/04 10:05:43 OpenArmor-testrule: INFO: Started (pid: 23007).</span>
<span class="go">OpenArmor-testrule: Type one log per line.</span>

<span class="go">Jul 4 10:05:30 enigma sshd[27588]: Failed password for invalid user test2 from 127.0.0.1 port 19130 ssh2</span>

<span class="go">**Phase 1: Completed pre-decoding.</span>
<span class="go">full event: ‘Jul 4 10:05:30 enigma sshd[27588]: Failed password for invalid user test2 from 127.0.0.1 port 19130 ssh2′</span>
<span class="go">hostname: ‘enigma’</span>
<span class="go">program_name: ’sshd’</span>
<span class="go">log: ‘Failed password for invalid user test2 from 127.0.0.1 port 19130 ssh2′</span>

<span class="go">**Phase 2: Completed decoding.</span>
<span class="go">decoder: ’sshd’</span>
<span class="go">srcip: ‘127.0.0.1′</span>

<span class="go">**Rule debugging:</span>
<span class="go">Trying rule: 1 - Generic template for all syslog rules.</span>
<span class="go">*Rule 1 matched.</span>
<span class="go">*Trying child rules.</span>
<span class="go">Trying rule: 5500 - Grouping of the pam_unix rules.</span>
<span class="go">Trying rule: 5700 - SSHD messages grouped.</span>
<span class="go">*Rule 5700 matched.</span>
<span class="go">*Trying child rules.</span>
<span class="go">Trying rule: 5709 - Useless SSHD message without an user/ip.</span>
<span class="go">Trying rule: 5711 - Useless SSHD message without a user/ip.</span>
<span class="go">Trying rule: 5707 - OpenSSH challenge-response exploit.</span>
<span class="go">Trying rule: 5701 - Possible attack on the ssh server (or version gathering).</span>
<span class="go">Trying rule: 5706 - SSH insecure connection attempt (scan).</span>
<span class="go">Trying rule: 5713 - Corrupted bytes on SSHD.</span>
<span class="go">Trying rule: 5702 - Reverse lookup error (bad ISP or attack).</span>
<span class="go">Trying rule: 5710 - Attempt to login using a non-existent user</span>
<span class="go">*Rule 5710 matched.</span>
<span class="go">*Trying child rules.</span>
<span class="go">Trying rule: 5712 - SSHD brute force trying to get access to the system.</span>

<span class="go">**Phase 3: Completed filtering (rules).</span>
<span class="go">Rule id: ‘5710′</span>
<span class="go">Level: ‘5′</span>
<span class="go">Description: ‘Attempt to login using a non-existent user’</span>
<span class="go">**Alert to be generated.</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2021, OpenArmor Project Team.<br/>
    OpenArmor <b>OpenArmor.net</b> domain owned and maintained by <a href="https://theopenarmor.org" target="_blank">OpenArmor Foundation</a><br/>
    Home page graphics courtesy of <a href="https://pixabay.com" target="_blank">pixabay</a>
    </p>
  </div>
</footer>
  </body>
</html>